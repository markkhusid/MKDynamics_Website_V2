\begin{verbatim}
- - -
jupytext:
  formats: md:myst
  text_representation:
    extension: .md
    format_name: myst
kernelspec:
  display_name: Python 3
  language: python
  name: python3
 - - -
\end{verbatim}

\subparagraph{Section Computing Pi: Compute Pi}

Adapted from: \href{https://github.com/gjbex/Fortran-MOOC/tree/master/source\_code/computing\_pi}{https://github.com/gjbex/Fortran-MOOC/tree/master/source\_code/computing\_pi}

\subparagraph{This program demonstrates computing $\pi$ in Fortran by using the following equation:}

\begin{equation}
\Large \pi = 4 \int_{0}^{1} \sqrt{1-x^2}dx
\end{equation}

\subparagraph{In file section\_computing\_pi\_compute\_pi.f90}

\begin{verbatim}
program compute_pi
    use, intrinsic :: iso_fortran_env, only : DP => REAL64, I8 => INT64
    implicit none
    integer(kind=I8) :: i, nr_iters
    real(kind=DP) :: delta, x, pi_val
    real(kind=DP) :: pi_val_actual

    pi_val = 0.0_DP
    pi_val_actual = 2.0_DP * acos(0.0_DP)
    nr_iters = get_nr_iters()
    delta = 1.0_DP/nr_iters
    x = 0.0_DP
    do i = 1, nr_iters
        pi_val = pi_val + sqrt(1.0_DP - x**2)
        x = x + delta
    end do
    pi_val = 4.0_DP*pi_val/nr_iters
    print '(A, I10, A, F25.15)', "After ", nr_iters, " loops, Pi = ", pi_val
    print '(A, F25.15)', "Actual value of Pi = ", pi_val_actual
    print '(A, F25.15)', "Absolute difference = ", abs(pi_val - pi_val_actual)

contains
     
    function get_nr_iters() result(nr_iters)
        use, intrinsic :: iso_fortran_env, only : error_unit
        implicit none
        integer(kind=I8) :: nr_iters
        integer(kind=I8), parameter :: default_nr_iters = 1000_I8
        character(len=1024) :: buffer, msg
        integer :: istat

        if (command_argument_count() >= 1) then
            call get_command_argument(1, buffer)
            read (buffer, fmt=*, iostat=istat, iomsg=msg) nr_iters
            if (istat /= 0) then
                write (unit=error_unit, fmt='(2A)') &
                    'error: ', msg
                stop 1
            end if
        else
            nr_iters = default_nr_iters
        end if
    end function get_nr_iters

end program compute_pi
\end{verbatim}

The above program is compiled and run using Fortran Package Manager (fpm):

\subparagraph{Build the Program using FPM (Fortran Package Manager)}

\begin{verbatim}
import os
root_dir = ""
root_dir = os.getcwd()
\end{verbatim}

The following configuration file (fpm.toml) was used:

\begin{verbatim}
name = "Section_Computing_Pi_Compute_Pi"

[build]
auto -executables = true
auto -tests = true
auto -examples = true

[install]
library = false

[[executable]]
name="Section_Computing_Pi_Compute_Pi"
source -dir="app"
main="section_computing_pi_compute_pi.f90"
\end{verbatim}

\begin{verbatim}
code_dir = root_dir + "/" + "Fortran_Code/Section_Computing_Pi_Compute_Pi"
\end{verbatim}

\begin{verbatim}
os.chdir(code_dir)
\end{verbatim}

\begin{verbatim}
build_status = os.system("fpm build 2>/dev/null")
\end{verbatim}

\subparagraph{Run the Program using FPM (Fortran Package Manager)}

\subparagraph{10 Iterations}

\begin{verbatim}
%%timeit -r 10 -n 1
exec_status = os.system("fpm run - - 10 2>/dev/null > output.txt")
\end{verbatim}

\begin{verbatim}
33.6 ms \pm 4.55 ms per loop (mean \pm std. dev. of 10 runs, 1 loop each)
\end{verbatim}

\begin{verbatim}
%cat output.txt
\end{verbatim}

\begin{verbatim}
After         10 loops, Pi =         3.304518326248318
Actual value of Pi =         3.141592653589793
Absolute difference =         0.162925672658525
\end{verbatim}

\subparagraph{100 Iterations}

\begin{verbatim}
%%timeit -r 10 -n 1
exec_status = os.system("fpm run - - 100 2>/dev/null > output.txt")
\end{verbatim}

\begin{verbatim}
33.5 ms \pm 7.69 ms per loop (mean \pm std. dev. of 10 runs, 1 loop each)
\end{verbatim}

\begin{verbatim}
%cat output.txt
\end{verbatim}

\begin{verbatim}
After        100 loops, Pi =         3.160417031779042
Actual value of Pi =         3.141592653589793
Absolute difference =         0.018824378189249
\end{verbatim}

\subparagraph{1,000 Iterations}

\begin{verbatim}
%%timeit -r 10 -n 1
exec_status = os.system("fpm run - - 1000 2>/dev/null > output.txt")
\end{verbatim}

\begin{verbatim}
32.9 ms \pm 4.03 ms per loop (mean \pm std. dev. of 10 runs, 1 loop each)
\end{verbatim}

\begin{verbatim}
%cat output.txt
\end{verbatim}

\begin{verbatim}
After       1000 loops, Pi =         3.143555466911022
Actual value of Pi =         3.141592653589793
Absolute difference =         0.001962813321229
\end{verbatim}

\subparagraph{10,000 Iterations}

\begin{verbatim}
%%timeit -r 10 -n 1
exec_status = os.system("fpm run - - 10000 2>/dev/null > output.txt")
\end{verbatim}

\begin{verbatim}
31.8 ms \pm 3 ms per loop (mean \pm std. dev. of 10 runs, 1 loop each)
\end{verbatim}

\begin{verbatim}
%cat output.txt
\end{verbatim}

\begin{verbatim}
After      10000 loops, Pi =         3.141791477611602
Actual value of Pi =         3.141592653589793
Absolute difference =         0.000198824021809
\end{verbatim}

\subparagraph{100,000 Iterations}

\begin{verbatim}
%%timeit -r 10 -n 1
exec_status = os.system("fpm run - - 100000 2>/dev/null > output.txt")
\end{verbatim}

\begin{verbatim}
34.4 ms \pm 4.95 ms per loop (mean \pm std. dev. of 10 runs, 1 loop each)
\end{verbatim}

\begin{verbatim}
%cat output.txt
\end{verbatim}

\begin{verbatim}
After     100000 loops, Pi =         3.141612616406209
Actual value of Pi =         3.141592653589793
Absolute difference =         0.000019962816416
\end{verbatim}

\subparagraph{1,000,000 Iterations}

\begin{verbatim}
%%timeit -r 10 -n 1
exec_status = os.system("fpm run - - 1000000 2>/dev/null > output.txt")
\end{verbatim}

\begin{verbatim}
35.9 ms \pm 5.26 ms per loop (mean \pm std. dev. of 10 runs, 1 loop each)
\end{verbatim}

\begin{verbatim}
%cat output.txt
\end{verbatim}

\begin{verbatim}
After    1000000 loops, Pi =         3.141594652402481
Actual value of Pi =         3.141592653589793
Absolute difference =         0.000001998812688
\end{verbatim}

\subparagraph{10,000,000 Iterations}

\begin{verbatim}
%%timeit -r 10 -n 1
exec_status = os.system("fpm run - - 10000000 2>/dev/null > output.txt")
\end{verbatim}

\begin{verbatim}
64.8 ms \pm 7.7 ms per loop (mean \pm std. dev. of 10 runs, 1 loop each)
\end{verbatim}

\begin{verbatim}
%cat output.txt
\end{verbatim}

\begin{verbatim}
After   10000000 loops, Pi =         3.141592854147901
Actual value of Pi =         3.141592653589793
Absolute difference =         0.000000200558108
\end{verbatim}

\subparagraph{100,000,000 Iterations}

\begin{verbatim}
%%timeit -r 10 -n 1
exec_status = os.system("fpm run - - 100000000 2>/dev/null > output.txt")
\end{verbatim}

\begin{verbatim}
274 ms \pm 9.74 ms per loop (mean \pm std. dev. of 10 runs, 1 loop each)
\end{verbatim}

\begin{verbatim}
%cat output.txt
\end{verbatim}

\begin{verbatim}
After  100000000 loops, Pi =         3.141592668260093
Actual value of Pi =         3.141592653589793
Absolute difference =         0.000000014670300
\end{verbatim}

\subparagraph{1,000,000,000 Iterations}

\begin{verbatim}
%%timeit -r 10 -n 1
exec_status = os.system("fpm run - - 1000000000 2>/dev/null > output.txt")
\end{verbatim}

\begin{verbatim}
2.34 s \pm 46.8 ms per loop (mean \pm std. dev. of 10 runs, 1 loop each)
\end{verbatim}

\begin{verbatim}
%cat output.txt
\end{verbatim}

\begin{verbatim}
After 1000000000 loops, Pi =         3.141592665675041
Actual value of Pi =         3.141592653589793
Absolute difference =         0.000000012085248
\end{verbatim}