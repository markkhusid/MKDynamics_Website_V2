{"version":3,"kind":"Notebook","sha256":"761f1721d080e2687188f5356d9476181d548c70ebd1c06fb35a974945314be7","slug":"sections.computer-programming.fortran.csv-fortran.csv-fortran-read-csv","location":"/Sections/Computer_Programming/Fortran/CSV_Fortran/csv_fortran_read_csv.ipynb","dependencies":[],"frontmatter":{"title":"Section: Read CSV Files","content_includes_title":true,"kernelspec":{"name":"py311_env","display_name":"Python 3.11","language":"python"},"authors":[{"nameParsed":{"literal":"Mark Khusid","given":"Mark","family":"Khusid"},"name":"Mark Khusid","id":"contributors-myst-generated-uid-0"}],"github":"https://github.com/markkhusid/MKDynamics_Website_V2","numbering":{"title":{"offset":4}},"source_url":"https://github.com/markkhusid/MKDynamics_Website_V2/blob/master/Sections/Computer_Programming/Fortran/CSV_Fortran/csv_fortran_read_csv.ipynb","edit_url":"https://github.com/markkhusid/MKDynamics_Website_V2/edit/master/Sections/Computer_Programming/Fortran/CSV_Fortran/csv_fortran_read_csv.ipynb","exports":[{"format":"ipynb","filename":"csv_fortran_read_csv.ipynb","url":"/build/csv_fortran_read_csv-3c8fa27504cb0eea93a16185aee78b6a.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"code","lang":"","value":"---\njupytext:\n  formats: md:myst\n  text_representation:\n    extension: .md\n    format_name: myst\nkernelspec:\n  display_name: Python 3\n  language: python\n  name: python3\n---","key":"d5gJj9rZ0h"}],"key":"OCS2NmSWDe"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Section: Read CSV Files","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rZXpKt1YyU"}],"identifier":"section-read-csv-files","label":"Section: Read CSV Files","html_id":"section-read-csv-files","implicit":true,"key":"fNECzPuOI2"}],"key":"O6wtSn5Cl0"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"In this section, we will read CSV files in Fortran using the CSV_Fortran Module.  The CSV_Fortran Module is a Fortran module that provides a simple interface for reading and writing CSV files.  The module is available at ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"T2QvQ7af9D"},{"type":"link","url":"https://github.com/jacobwilliams/csv-fortran","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"https://​github​.com​/jacobwilliams​/csv​-fortran","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ui7hclM8XH"}],"urlSource":"https://github.com/jacobwilliams/csv-fortran","error":true,"key":"fxMfYisBqb"},{"type":"text","value":".  Documentation for the module is available at ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Mjwcg1E7VW"},{"type":"link","url":"https://jacobwilliams.github.io/csv-fortran/","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"https://​jacobwilliams​.github​.io​/csv​-fortran/","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RSrxTpiPfh"}],"urlSource":"https://jacobwilliams.github.io/csv-fortran/","key":"ZQVUSN5GXz"},{"type":"text","value":".","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"TGnAYHqHaG"}],"key":"oLD0NBMXjz"}],"key":"kAikygSHj3"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Example Programs","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tanwEJ11wA"}],"identifier":"example-programs","label":"Example Programs","html_id":"example-programs","implicit":true,"key":"kvy8oBh9nO"}],"key":"rmK3nxojEj"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"In the documentation for the CSV_Fortran Module, there are several example programs that demonstrate how to read and write CSV files.  We will use the example programs to demonstrate how to read CSV files in Fortran.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cxXZ55W0gh"}],"key":"gUXmFzpiuz"}],"key":"eE46t7LyZz"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Reading a CSV File","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"eV76h0xLBL"}],"identifier":"reading-a-csv-file","label":"Reading a CSV File","html_id":"reading-a-csv-file","implicit":true,"key":"TmZ1xM2w4w"}],"key":"x56Txi0QFc"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The following example program reads a CSV file named ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"hydSEJ2FIF"},{"type":"inlineCode","value":"test.csv","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"eW27VFXazL"},{"type":"text","value":":","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"wY0O8fdD5q"}],"key":"UIXi1a4ycZ"}],"key":"GRvuvQiVxg"},{"type":"block","kind":"notebook-content","children":[{"type":"include","file":"Fortran_Code/Section_CSV_Fortran_Read_CSV/app/section_csv_fortran_read_csv.f90","literal":true,"children":[{"type":"code","value":"program csv_read_test\n\n  use csv_module\n  use iso_fortran_env, only: wp => real64\n  \n  implicit none\n  \n  type(csv_file) :: f\n  logical :: status_ok\n  integer,dimension(:),allocatable :: itypes\n\n  character(len=5),dimension(:),allocatable :: header\n  real(wp),dimension(:),allocatable :: x,y,z\n  logical,dimension(:),allocatable :: t\n\n  character(len=30), dimension(:,:), allocatable :: table_data_strings\n  real(wp), dimension(:,:), allocatable :: table_data_floats\n\n  character(len=30) :: trimmed_string\n    \n  integer :: i, j, n_rows, n_cols\n  integer, dimension(1) :: dim_header\n  integer, dimension(2) :: dims_table\n  \n  ! read the file\n  call f%read('test.csv',header_row=1,status_ok=status_ok)\n  \n  ! get the header and type info\n  call f%get_header(header,status_ok)\n  call f%variable_types(itypes,status_ok)\n  \n  ! get some data\n  call f%get(1, x, status_ok)\n  call f%get(2, y, status_ok)\n  call f%get(3, z, status_ok)\n  call f%get(4, t, status_ok)\n  call f%get(table_data_strings, status_ok)\n\n  ! print the size, shape and contents of the header\n  print *, \"Print out the size, shape and contents of the header\"\n  write (*, '(a, i3)') 'size = ', size(header)\n  dim_header = shape(header)\n  write (*, '(a, i3)') 'shape = ', dim_header(1)\n  write (*, *) 'header = ', header\n\n  print *\n\n  ! print the types\n  print *, \"Print out the types\"\n  write (*, *) 'types = ', itypes\n\n  print *\n  \n  ! print the data\n  print *, \"Print out the data that was read one at a time\"\n  print *, 'x = ',x\n  print *, 'y = ',y\n  print *, 'z = ',z\n  print *, 't = ',t\n\n  print *\n\n  ! print the size, shape and contents of the table data\n  print *, \"Print out the size, dimensions and contents of the table data read all at once\"\n  write (*, '(a, i3)') 'table size = ', size(table_data_strings)\n\n  dims_table = shape(table_data_strings)\n  n_rows = dims_table(1)\n  n_cols = dims_table(2)\n\n  write (*, '(a, i3)') '# of rows = ', n_rows\n  write (*, '(a, i3)') '# of columns = ', n_cols\n  print *\n  print *, \"Printing out the table data directly from the variable...\"\n  write (*, *) 'table_data = ', table_data_strings\n\n  ! use loop to print the table data\n  print *, \"Using loop to print the table data...\"\n  do i = 1, size(table_data_strings,1)\n    write (*, *) table_data_strings(i,:)\n  end do\n\n  print *\n\n  ! convert the table data to floats\n  print *, \"Converting the table data from strings to floats...\"\n\n  allocate(table_data_floats(n_rows,n_cols))\n  do i = 1, n_rows\n    do j = 1, (n_cols - 1) ! last column is a string i.e. T or F\n      trimmed_string = adjustl(trim(table_data_strings(i,j)))\n      read(trimmed_string, *) table_data_floats(i,j)\n      !read(trimmed_string, '(f30.20)') table_data_floats(i,j)\n      !print *, 'trimmed_string = ', trimmed_string\n    end do\n  end do\n\n  print *\n\n  ! print the table data as floats using a loop\n  print *, \"Printing out the table data as floats using a loop\"\n  do i = 1, n_rows\n      write (*, *) table_data_floats(i,1:3)\n  end do\n\n  deallocate(table_data_floats)\n  deallocate(table_data_strings)\n  deallocate(header)\n  deallocate(itypes)\n  deallocate(x)\n  deallocate(y)\n  deallocate(z)\n  deallocate(t)\n\n  ! destroy the file\n  call f%destroy()\n  \n  end program csv_read_test\n  \n","lang":"fortran","filename":"section_csv_fortran_read_csv.f90","key":"fA8k63MmDK"}],"key":"JY2pBUqYMP"}],"key":"xSvuG9kFcD"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The program reads a CSV file named ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tm3y1zgB5u"},{"type":"inlineCode","value":"test.csv","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jQo1Bt5l1L"},{"type":"text","value":" with the following contents:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XIzz1riQxl"}],"key":"nl64ffv2ja"},{"type":"code","lang":"bash","value":"x,y,z,t\n1.000,2.000,3.000,T\n4.000,5.000,6.000,F","position":{"start":{"line":3,"column":1},"end":{"line":7,"column":1}},"key":"cb9wJvlanG"}],"key":"MGtnRCYAQ9"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Building the Example Program using FPM (Fortran Package Manager)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BmwGjTAiee"}],"identifier":"building-the-example-program-using-fpm-fortran-package-manager","label":"Building the Example Program using FPM (Fortran Package Manager)","html_id":"building-the-example-program-using-fpm-fortran-package-manager","implicit":true,"key":"HaLeGJD0ks"}],"key":"P46iBImxxC"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"TOML File","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"G4be3S4Idf"}],"identifier":"toml-file","label":"TOML File","html_id":"toml-file","implicit":true,"key":"OLlBO8rk7u"}],"key":"BxOESjq5KP"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The above program was compiled using the Fortran Package Manager (FPM).  The following is the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"qUoMGvFcoe"},{"type":"inlineCode","value":"fpm.toml","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"uTY7tCQHDW"},{"type":"text","value":" file used to build the program:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"FrlJB2jTvE"}],"key":"BGXcjTZIBw"}],"key":"OmKAeDd0gx"},{"type":"block","kind":"notebook-content","children":[{"type":"include","file":"Fortran_Code/Section_CSV_Fortran_Read_CSV/fpm.toml","literal":true,"children":[{"type":"code","value":"name = \"Section_CSV_Fortran_Read_CSV\"\n\n[build]\nauto-executables = true\nauto-tests = true\nauto-examples = true\n\n[install]\nlibrary = false\n\n[dependencies]\ncsv-fortran = { git=\"https://github.com/jacobwilliams/csv-fortran.git\" }\n\n[[executable]]\nname=\"Section_CSV_Fortran_Read_CSV\"\nsource-dir=\"app\"\nmain=\"section_csv_fortran_read_csv.f90\"\n\n\n\n","lang":"toml","filename":"fpm.toml","key":"VeCyfnVZMz"}],"key":"KKds50hAuP"}],"key":"r1Jxb9673I"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Build the Program","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"yyjtgcvF3x"}],"identifier":"build-the-program","label":"Build the Program","html_id":"build-the-program","implicit":true,"key":"YJHlTPY3xc"}],"key":"hBfvfer72d"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import os\nroot_dir = \"\"\nroot_dir = os.getcwd()","key":"qJO8nxNOXP"},{"type":"outputs","id":"zbrv9k9Pm1XaC90HdEw_s","children":[],"key":"snqpAF9jO5"}],"key":"wSTgOJ6T8I"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"code_dir = root_dir + \"/\" + \"Fortran_Code/Section_CSV_Fortran_Read_CSV\"","key":"hXlzms2WW6"},{"type":"outputs","id":"cFgV-DzFor6gx31ZiwJsV","children":[],"key":"E0mtdJEVD2"}],"key":"yNQ3n6JR3h"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"os.chdir(code_dir)","key":"a3NiJsIeYg"},{"type":"outputs","id":"WVTDRtX77TBUJl6i_VJxb","children":[],"key":"JHUQsUAGth"}],"key":"ghcZEu0vyA"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"build_status = os.system(\"fpm build 2>/dev/null\")","key":"G7HBpc6Vsg"},{"type":"outputs","id":"pihiYTtU5Tixi8dBNrr2h","children":[],"key":"P2I1CvVcnv"}],"key":"czyVdo4vG6"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Display the CSV File","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bAP4Epans3"}],"identifier":"display-the-csv-file","label":"Display the CSV File","html_id":"display-the-csv-file","implicit":true,"key":"JVJEWzcNyO"}],"key":"DY3GgvestA"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"!cat test.csv","key":"kvMPU26MhE"},{"type":"outputs","id":"UDoSMyhJcWis9X8SsK7_z","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"\"x\",\"y\",\"z\",\"t\"\n1.000,2.000,3.000,T\n4.000,5.000,6.000,F\n"},"children":[],"key":"Q7JadykVtI"}],"key":"BHdiPaLX8J"}],"key":"HJDNKAm1mg"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Run the Program","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gabCmxROSd"}],"identifier":"run-the-program","label":"Run the Program","html_id":"run-the-program","implicit":true,"key":"TzDSpEWATC"}],"key":"aP1cxOjTlJ"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The program is then run:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xJ7YGvrCVu"}],"key":"gwDLth6eK6"}],"key":"dHnvvmqQvx"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"exec_status = \\\n    os.system(\"fpm run 2>/dev/null\")","key":"Jha2xPvehk"},{"type":"outputs","id":"OF3Dp-hudx1gteVD3ygD-","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":" Print out the size, shape and contents of the header\nsize =   4\nshape =   4\n header = x    y    z    t    \n\n Print out the types\n types =            2           2           2           4\n\n Print out the data that was read one at a time\n x =    1.0000000000000000        4.0000000000000000     \n y =    2.0000000000000000        5.0000000000000000     \n z =    3.0000000000000000        6.0000000000000000     \n t =  T F\n\n Print out the size, dimensions and contents of the table data read all at once\ntable size =   8\n# of rows =   2\n# of columns =   4\n\n Printing out the table data directly from the variable...\n table_data = 1.000                         4.000                         2.000                         5.000                         3.000                         6.000                         T                             F                             \n Using loop to print the table data...\n 1.000                         2.000                         3.000                         T                             \n 4.000                         5.000                         6.000                         F                             \n\n Converting the table data from strings to floats...\n\n Printing out the table data as floats using a loop\n   1.0000000000000000        2.0000000000000000        3.0000000000000000     \n   4.0000000000000000        5.0000000000000000        6.0000000000000000     \n"},"children":[],"key":"rk6CAWIJNs"}],"key":"zsSOrWEi0l"}],"key":"IxFpdaqJTP"}],"key":"V1YIyYKR1o"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"CSV Fortran Module","url":"/sections/computer-programming/fortran/csv-fortran/csv-fortran-head","group":"Computer Programming"},"next":{"title":"Section: Write CSV Files","url":"/sections/computer-programming/fortran/csv-fortran/csv-fortran-write-csv","group":"Computer Programming"}}},"domain":"http://localhost:3005"}