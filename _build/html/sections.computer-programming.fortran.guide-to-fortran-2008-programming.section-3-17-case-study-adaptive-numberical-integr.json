{"version":3,"kind":"Notebook","sha256":"38910d106c2eaeebda2da8eff199f97b7b6f4b0255afabbf5c9fc3e9b29f56dc","slug":"sections.computer-programming.fortran.guide-to-fortran-2008-programming.section-3-17-case-study-adaptive-numberical-integr","location":"/Sections/Computer_Programming/Fortran/Guide_to_Fortran_2008_Programming/Section_3_17_Case_Study__Adaptive_Numberical_Integration.ipynb","dependencies":[],"frontmatter":{"title":"Section 3.17: Case Study: Adaptive Numerical Integration","content_includes_title":true,"kernelspec":{"name":"python3","display_name":"Python 3.9.2 64-bit","language":"python"},"authors":[{"nameParsed":{"literal":"Mark Khusid","given":"Mark","family":"Khusid"},"name":"Mark Khusid","id":"contributors-myst-generated-uid-0"}],"github":"https://github.com/markkhusid/MKDynamics_Website_V2","numbering":{"title":{"offset":4}},"source_url":"https://github.com/markkhusid/MKDynamics_Website_V2/blob/master/Sections/Computer_Programming/Fortran/Guide_to_Fortran_2008_Programming/Section_3_17_Case_Study__Adaptive_Numberical_Integration.ipynb","edit_url":"https://github.com/markkhusid/MKDynamics_Website_V2/edit/master/Sections/Computer_Programming/Fortran/Guide_to_Fortran_2008_Programming/Section_3_17_Case_Study__Adaptive_Numberical_Integration.ipynb","exports":[{"format":"ipynb","filename":"Section_3_17_Case_Study__Adaptive_Numberical_Integration.ipynb","url":"/build/Section_3_17_Case_St-4a63be5b2fb7750271d4f3108146adf4.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"code","lang":"","value":"---\njupytext:\n  formats: md:myst\n  text_representation:\n    extension: .md\n    format_name: myst\nkernelspec:\n  display_name: Python 3\n  language: python\n  name: python3\n---","key":"CvCRyh4b9X"}],"key":"Ff96qb6P6c"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Section 3.17: Case Study: Adaptive Numerical Integration","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"IK4Kce0C0j"}],"identifier":"section-3-17-case-study-adaptive-numerical-integration","label":"Section 3.17: Case Study: Adaptive Numerical Integration","html_id":"section-3-17-case-study-adaptive-numerical-integration","implicit":true,"key":"bvjiAnVEhI"}],"visibility":"show","key":"QjYwfvAThu"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Adapted from: “Guide to Fortran 2008 Programming” by Walter S. Brainerd (Springer 2015)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Cz0sYJjEmA"}],"key":"qkkSfLQdnG"}],"key":"Uaa1bNxRBI"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Program to demonstrate the modules and procedures in Fortran.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WznT7qrHb8"}],"identifier":"program-to-demonstrate-the-modules-and-procedures-in-fortran","label":"Program to demonstrate the modules and procedures in Fortran.","html_id":"program-to-demonstrate-the-modules-and-procedures-in-fortran","implicit":true,"key":"nymv12rHCI"}],"key":"lePT2EWhAv"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"This program calculates the integral:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"L5Jn97mUYn"}],"key":"NfYPJbXyyt"}],"key":"eklFGRFQ29"},{"type":"block","kind":"notebook-content","children":[{"type":"math","value":"\\Large \\int_{-4}^4 e^{x^2} d{x}","position":{"start":{"line":1,"column":1},"end":{"line":3,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mstyle mathsize=\"1.44em\"><msubsup><mo>∫</mo><mrow><mo>−</mo><mn>4</mn></mrow><mn>4</mn></msubsup><msup><mi>e</mi><msup><mi>x</mi><mn>2</mn></msup></msup><mi>d</mi><mi>x</mi></mstyle></mrow><annotation encoding=\"application/x-tex\">\\Large \\int_{-4}^4 e^{x^2} d{x}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:3.5918em;vertical-align:-1.375em;\"></span><span class=\"mop sizing reset-size6 size8\"><span class=\"mop op-symbol large-op\" style=\"margin-right:0.44445em;position:relative;top:-0.0011em;\">∫</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.5395em;\"><span style=\"top:-2.103em;margin-left:-0.4445em;margin-right:0.0347em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size8 size6 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">4</span></span></span></span><span style=\"top:-4.0919em;margin-right:0.0347em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size8 size6 mtight\"><span class=\"mord mtight\">4</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9548em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord sizing reset-size6 size8\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9784em;\"><span style=\"top:-3.413em;margin-right:0.0347em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size8 size6 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class=\"mord mathnormal sizing reset-size6 size8\">d</span><span class=\"mord sizing reset-size6 size8\"><span class=\"mord mathnormal\">x</span></span></span></span></span></span>","enumerator":"1","key":"WUrMvEwOQd"}],"key":"nhNZO49hw1"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"using adaptive numberical integration.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VSny7XLxf7"}],"key":"fZXq6e5LPp"}],"key":"w5SdqE7NW7"},{"type":"block","kind":"notebook-content","children":[{"type":"code","lang":"fortran","value":"module math_module\n    implicit none\n    private\n    real, public, parameter :: pi    = 3.1415926\n    real, public, parameter :: e     = 2.7182818\n    real, public, parameter :: gamma = 0.5772156\nend module math_module\n\nmodule function_module\n\n    implicit none\n    private\n    public :: f\n\ncontains\n    function f(x) result (f_result)\n        real, intent(in)        :: x\n        real                    :: f_result\n\n        f_result = exp(-x**2.0)\n    end function f\nend module function_module\n\n\nmodule integral_module\n\n    implicit none\n    private\n    public :: integral\n\ncontains\n\n    recursive function integral(f, a, b, tolerance) result (integral_result)\n\n        intrinsic :: abs\n\n        interface\n            function f(x) result (f_result)\n                real, intent(in) :: x\n                real :: f_result\n            end function f\n        end interface\n\n        real, intent(in)    :: a, b, tolerance\n        real                :: integral_result\n        real                :: h, mid\n        real                :: one_trapezoid_area, two_trapezoid_area\n        real                :: left_area, right_area\n\n        h = b - a\n        mid = (a + b) / 2\n        one_trapezoid_area = h * (f(a) + f(b)) / 2.0\n        two_trapezoid_area = h/2 * (f(a) + f(mid)) / 2.0 + &\n                                h/2 * (f(mid) + f(b)) / 2.0\n        if (abs(one_trapezoid_area - two_trapezoid_area) < 3.0 * tolerance) then\n            integral_result = two_trapezoid_area\n        else\n            left_area = integral (f, a, mid, tolerance / 2)\n            right_area = integral (f, mid, b, tolerance / 2)\n            integral_result = left_area + right_area\n        end if\n\n    end function integral\n\nend module integral_module\n\nprogram integrate\n\n    use function_module\n    use integral_module\n    use math_module, only : pi\n    implicit none\n\n    real        :: x_min, x_max\n    real        :: answer\n\n    x_min = -4.0\n    x_max = 4.0\n    answer = integral(f, x_min, x_max, tolerance = 0.01)\n    write (*, '(a, f5.1, a, f5.1, a)') & \n        \"This program computes the integral of e^(-x^2) from \", &\n        x_min, \" to \", x_max, \" using adaptive numerical integration.\"\n    print *\n    write (*, '(a, f11.6)') \"The integral is approximately \", answer\n    write (*, '(a, f11.6)') \"The exact answer is \", sqrt(pi)\n\nend program integrate","position":{"start":{"line":1,"column":1},"end":{"line":89,"column":1}},"key":"l1SH8xl2Nc"}],"key":"QCgdAq6w9G"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The above program is compiled and run using Fortran Package Manager (fpm):","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vObdWoNRTw"}],"key":"CqBcAcY4lm"}],"key":"RgMJ8TRA8d"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import os\nroot_dir = os.getcwd()","key":"DYgEJbfbSw"},{"type":"outputs","id":"nf3l1hVVMjYI1W4po-75M","children":[],"key":"KBJVaNdyUb"}],"key":"inhf18WaOc"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"code_dir = root_dir + \"/\" + \"Fortran_Code/Section_3_17_Case_Study__Adaptive_Numerical_Integration\"","key":"cd6BUjp2s2"},{"type":"outputs","id":"7I5XLH5dUOvs_TTwAabZN","children":[],"key":"O04nC8jWlY"}],"key":"ruJesANF2i"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"os.chdir(code_dir)","key":"wovr344bTi"},{"type":"outputs","id":"yGyj0CZ8L3nrnHqrk_DKg","children":[],"key":"onDOhT8GgQ"}],"key":"NyIqfeCSuH"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"build_status = os.system(\"fpm build 2>/dev/null\")","key":"e62UelmgTN"},{"type":"outputs","id":"JOxACAMipK6vTiZTLZBvE","children":[],"key":"m2gTogZO18"}],"key":"NiKPzbqa79"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"exec_status = os.system(\"fpm run 2>/dev/null\")","key":"ofLQpxZB4c"},{"type":"outputs","id":"vn2AQMx2a40O918Te827s","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"This program computes the integral of e^(-x^2) from  -4.0 to   4.0 using adaptive numerical integration.\n\nThe integral is approximately    1.777074\nThe exact answer is    1.772454\n"},"children":[],"key":"uxovoFIegz"}],"key":"MUagiQ27Ro"}],"key":"BDiX7CPcfb"}],"key":"OzoskIdJyi"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Section 3.8: Argument Passing","url":"/sections/computer-programming/fortran/guide-to-fortran-2008-programming/section-3-8-argument-passing","group":"Computer Programming"},"next":{"title":"Section 4.1: Elsewhere Example","url":"/sections/computer-programming/fortran/guide-to-fortran-2008-programming/section-4-1-elsewhere-example","group":"Computer Programming"}}},"domain":"http://localhost:3007"}