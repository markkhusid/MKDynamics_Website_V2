{"version":3,"kind":"Notebook","sha256":"f3f74320b75720ac1efb8bde114a0d2d7c1f20e34c67e1d604e3b4766f3b870d","slug":"sections.computer-programming.python.python-playground.section-chapter-4-karplus-strong","location":"/Sections/Computer_Programming/Python/Python_Playground/Section_Chapter_4_Karplus_Strong.ipynb","dependencies":[],"frontmatter":{"title":"Chapter 4: Karplus Strong Algorithm","content_includes_title":true,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"authors":[{"nameParsed":{"literal":"Mark Khusid","given":"Mark","family":"Khusid"},"name":"Mark Khusid","id":"contributors-myst-generated-uid-0"}],"github":"https://github.com/markkhusid/MKDynamics_Website_V2","numbering":{"title":{"offset":4}},"source_url":"https://github.com/markkhusid/MKDynamics_Website_V2/blob/master/Sections/Computer_Programming/Python/Python_Playground/Section_Chapter_4_Karplus_Strong.ipynb","edit_url":"https://github.com/markkhusid/MKDynamics_Website_V2/edit/master/Sections/Computer_Programming/Python/Python_Playground/Section_Chapter_4_Karplus_Strong.ipynb","exports":[{"format":"ipynb","filename":"Section_Chapter_4_Karplus_Strong.ipynb","url":"/build/Section_Chapter_4_Ka-12b781eca8afd839acd491bae937824d.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"code","lang":"","value":"---\njupytext:\n  formats: md:myst\n  text_representation:\n    extension: .md\n    format_name: myst\nkernelspec:\n  display_name: Python 3\n  language: python\n  name: python3\n---","key":"OyICcqjzbR"}],"key":"y4ueJ4PfrB"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Chapter 4: Karplus Strong Algorithm","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"I7L0qvdaOD"}],"identifier":"chapter-4-karplus-strong-algorithm","label":"Chapter 4: Karplus Strong Algorithm","html_id":"chapter-4-karplus-strong-algorithm","implicit":true,"key":"tYdHuVdK0v"}],"visibility":"show","key":"Sr1N1e1sOU"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Adapted from: ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Ew1FOsezKZ"},{"type":"link","url":"https://www.amazon.com/Python-Playground-2nd-Mahesh-Venkitachalam/dp/1718503040/ref=sr_1_4?keywords=python+playground&sr=8-4","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"“Python Playground: Geeky Projects for the Curious Programmer”","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"k124Uis22e"}],"urlSource":"https://www.amazon.com/Python-Playground-2nd-Mahesh-Venkitachalam/dp/1718503040/ref=sr_1_4?keywords=python+playground&sr=8-4","key":"zPbRzBiG4e"},{"type":"text","value":" by Mahesh Venkitachalam (No Starch Press)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pLXIttwVZq"}],"key":"SsYsBUwAD4"}],"key":"fGbuMiVedc"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"This program implements the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RRxxRYNlVH"},{"type":"link","url":"https://en.wikipedia.org/wiki/Karplus%E2%80%93Strong_string_synthesis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Karplus–Strong string synthesis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"FGe3QyBkAY"}],"urlSource":"https://en.wikipedia.org/wiki/Karplus%E2%80%93Strong_string_synthesis","data":{"page":"Karplus%E2%80%93Strong_string_synthesis","wiki":"https://en.wikipedia.org/","lang":"en"},"internal":false,"protocol":"wiki","key":"ZbuATUNXOb"},{"type":"text","value":".  According to ChatGPT 4.0:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"nUHH7eqGGW"}],"key":"ivVABgjP7w"}],"key":"oHvN6FZCif"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"ChatGPT 4.0 Output","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"KdDyo46TR5"}],"identifier":"chatgpt-4-0-output","label":"ChatGPT 4.0 Output","html_id":"chatgpt-4-0-output","implicit":true,"key":"iBEt9N3Yqz"}],"key":"Dc9DlMiN04"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The Karplus-Strong algorithm is a method used in digital signal processing and physical modeling synthesis to simulate the sound of a plucked string or percussion instruments. Developed by Kevin Karplus and Alex Strong in 1983, this algorithm is a simple yet powerful technique for synthesizing realistic string sounds and has been influential in the field of computer music.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"UAWAL4Zzya"}],"key":"DOarNKXIaM"},{"type":"heading","depth":3,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Basic Concept","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"HdD1AuUy8w"}],"identifier":"basic-concept","label":"Basic Concept","html_id":"basic-concept","implicit":true,"key":"a53hYP6VDm"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"The Karplus-Strong algorithm uses a concept known as a “wavetable synthesis”. Here’s how it works:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"rWVvwK1jBW"}],"key":"yVbdgbX3qc"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":7,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Initial Noise Burst","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"Pn74tIqztO"}],"key":"L1ttVG5W1H"},{"type":"text","value":": The algorithm starts with a buffer (wavetable) filled with random values. This buffer represents a noise burst, similar to the initial complex vibrations when a string is plucked.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"qgNtGlhhSp"}],"key":"gEknZHN2Dj"}],"key":"Y4D3L7mvxr"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"strong","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Circular Buffer Feedback Loop","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"QUqwhgF5Yv"}],"key":"I79HLliq1D"},{"type":"text","value":": The buffer is treated as a circular buffer, meaning that once the playback reaches the end of the buffer, it wraps around to the start again. The contents of this buffer are continuously fed back into itself, creating a feedback loop.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"eaM970RNVk"}],"key":"rM5YGpnyfl"}],"key":"NGwDOEunAB"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"strong","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Low-Pass Filter","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"MqiBBr4HXN"}],"key":"rDKb28LZuK"},{"type":"text","value":": Each time the buffer wraps around, the algorithm applies a simple low-pass filtering process. This usually involves averaging each sample with the next one (or with a small number of subsequent samples). This filtering simulates the energy loss in a real string due to factors like air resistance and internal friction.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"YmmiHLIDGB"}],"key":"mUKPMR1CzW"}],"key":"chjZjdnX2B"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"strong","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Resulting Sound","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"ivciQB5Aop"}],"key":"aaVDw7vJ0K"},{"type":"text","value":": The output sound is created by continuously reading the values from this buffer. The low-pass filtering gradually turns the initial noise into a harmonic wave, mimicking the behavior of a vibrating string.","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"s6cPg72Qk2"}],"key":"KGNsDddBRH"}],"key":"W6IxQgG1jZ"}],"key":"PqqMDRwXsl"},{"type":"heading","depth":3,"position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Characteristics and Usage","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"jcX23wfXDY"}],"identifier":"characteristics-and-usage","label":"Characteristics and Usage","html_id":"characteristics-and-usage","implicit":true,"key":"UH0XLzNtBf"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":17,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":17,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"strong","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Realism and Simplicity","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"FNsnihKPK2"}],"key":"AINLSO1nMH"},{"type":"text","value":": The Karplus-Strong algorithm is renowned for its ability to produce realistic string-like sounds with a very simple implementation, making it computationally efficient.","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"VSgAY3EPJ5"}],"key":"smjA0Caafr"}],"key":"uFHAlYJXK2"},{"type":"listItem","spread":true,"position":{"start":{"line":19,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"strong","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"Modifications for Different Sounds","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"BV78kLwCI0"}],"key":"BUBq4gGUF0"},{"type":"text","value":": The algorithm can be modified to simulate different types of plucked string instruments. Adjusting the initial conditions (like the noise burst) and parameters (like the low-pass filter and the buffer length, which determines the pitch) allows for a variety of sounds.","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"PQeZO238zb"}],"key":"hk6OqNzZYy"}],"key":"zioSyaQyrE"},{"type":"listItem","spread":true,"position":{"start":{"line":21,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"strong","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"Extended Techniques","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"P0WXSZnKK7"}],"key":"QhoJ8c8AGo"},{"type":"text","value":": Over the years, various extensions and modifications have been made to the basic algorithm to improve realism or to simulate different characteristics of string instruments.","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"Mxtak3rBcW"}],"key":"CbcFZ4Wqdh"}],"key":"TB0LRoudFJ"}],"key":"Qdlkx124tx"},{"type":"heading","depth":3,"position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"Applications","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"vu44TN6t05"}],"identifier":"applications","label":"Applications","html_id":"applications","implicit":true,"key":"zUXa0PueSe"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":25,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"text","value":"Music Synthesis","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"FoH13vH2O1"}],"key":"ZCyngVFdyg"},{"type":"text","value":": The Karplus-Strong algorithm is used in synthesizers and music software to generate string sounds.","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"oDovmOkuDp"}],"key":"VFbUesp3ng"}],"key":"flQk6FLDNb"},{"type":"listItem","spread":true,"position":{"start":{"line":26,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"text","value":"Sound Effects","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"S3xIgkG1SK"}],"key":"V1wMwUFeYO"},{"type":"text","value":": It’s also used in video games and other applications for generating realistic sound effects on-the-fly.","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"wOIcVVVL1q"}],"key":"vDDdRlAyEJ"}],"key":"vnHtaJ38l2"}],"key":"GX96qMwJBS"},{"type":"paragraph","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"text","value":"The simplicity and effectiveness of the Karplus-Strong algorithm make it a staple in the field of digital sound synthesis, demonstrating how complex and natural phenomena can be simulated with relatively simple computational models.","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"KPjXJyAPHn"}],"key":"mlzAg7Ywup"}],"key":"fMlNyOCRSe"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"In file ks.py","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"byIMfDTVoQ"}],"identifier":"in-file-ks-py","label":"In file ks.py","html_id":"in-file-ks-py","implicit":true,"key":"L3zSQTF0vp"}],"key":"h8OE1l9nQo"},{"type":"block","kind":"notebook-content","children":[{"type":"include","file":"Python_Code/Chapter_4/ks.py","literal":true,"children":[{"type":"code","value":"import sys, os\nimport time, random\nimport wave, argparse, pygame\nimport numpy as np\n\n# I added the next two lines.  TkAgg uses the Tkinter rederer, which seems to work on my system.\n# You may need to try other renderers to get the plot drawing to work\nimport matplotlib\nmatplotlib.use('TkAgg')\n\n\nfrom collections import deque\nfrom matplotlib import pyplot as plt\n\n# show plot of algorithm in action?\ngShowPlot = False\n\n# notes of a Pentatonic Minor Scale\n# piano C4-E(b)-F-G-B(b)-C5\npmNotes = {'C4': 262, 'Eb': 311, 'F': 349, 'G': 391, 'Bb': 466}\n\ndef writeWAVE(fname, data):\n    # open file\n    file = wave.open(fname, 'wb')\n    # WAV file parameters\n    nChannels = 1\n    sampleWidth = 2\n    frameRate = 44100\n    nFrames = 44100\n    # set parameters\n    file.setparams((nChannels, sampleWidth, frameRate, nFrames, 'NONE', 'noncompressed'))\n    file.writeframes(data)\n    file.close\n    \n# generate note of given frequency\ndef generateNote(freq):\n    nSamples = 44100\n    sampleRate = 44100\n    N = int(sampleRate / freq)\n    \n    # initialize ring buffer\n    buf = deque([random.random() - 0.5 for i in range(N)])\n    \n    # plot if flag set\n    if gShowPlot:\n        axline, = plt.plot(buf)\n    \n    # initialize sample buffer\n    samples = np.array([0]*nSamples, 'float32')\n    for i in range(nSamples):\n        samples[i] = buf[0]\n        avg = 0.995 * 0.5 * (buf[0] + buf[1])\n        buf.append(avg)\n        buf.popleft()\n        # plot if flag set\n        if gShowPlot:\n            if i % 1000 == 0:\n                axline.set_ydata(buf)\n                plt.draw()\n        \n    # convert samples to 16-bit values and then to a string\n    # the maximum value is 32767 for 16-bit\n    samples = np.array(samples*32767, 'int16')\n    return samples.tostring()\n    \n# play a WAV file\nclass NotePlayer:\n    # constructor\n    def __init__(self):\n        pygame.mixer.pre_init(44100, -16, 1, 2048)\n        pygame.init()\n        # dictionary of notes\n        self.notes = {}\n    \n    # add a note\n    def add(self, fileName):\n        self.notes[fileName] = pygame.mixer.Sound(fileName)\n    \n    # play a note\n    def play(self, fileName):\n        try:\n            self.notes[fileName].play()\n        except:\n            print(fileName + ' not found!')\n            \n    def playRandom(self):\n        \"\"\" play a random note \"\"\"\n        index = random.randint(0, len(self.notes)-1)\n        note = list(self.notes.values())[index]\n        note.play()\n        \n# main() function\ndef main():\n    # declare global var\n    global gShowPlot\n    \n    parser = argparse.ArgumentParser(description=\"Generating sounds with Karplus String Algorithm\")\n    # add arguments\n    parser.add_argument('--display', action='store_true', required=False)\n    parser.add_argument('--play', action='store_true', required=False)\n    parser.add_argument('--piano', action='store_true', required=False)\n    args = parser.parse_args()\n    \n    # I added the next line to start the Python debugger, so that I can step through the script\n    # and prevent the plot from flashing on and off.\n    # By stepping through the script until just before the end, the plot stays up.\n    import pdb; pdb.set_trace()\n    \n    # show plot if flag set\n    if args.display:\n        gShowPlot = True\n        plt.ion()\n        #plt.show()\n        \n    # create note player\n    nplayer = NotePlayer()\n    \n    print('creating notes...')\n    for name, freq in list(pmNotes.items()):\n        fileName = name +'.wav'\n        if not os.path.exists(fileName) or args.display:\n            data = generateNote(freq)\n            print('creating ' + fileName + '...')\n            writeWAVE(fileName, data)\n        else:\n            print('filename aready created. skipping...')\n        \n        # add note to player\n        nplayer.add(name + '.wav')\n        \n        # play note if display flag set\n        if args.display:\n            nplayer.play(name + '.wav')\n            time.sleep(0.5)\n                \n    \n    \n    # play a random tune\n    if args.play:\n        while True:\n            try:\n                nplayer.playRandom()\n                # rest - 1 to 8 beats\n                rest = np.random.choice([1, 2, 4, 8], 1, p=[0.15, 0.7, 0.1, 0.05])\n                time.sleep(0.25*rest[0])\n            except KeyboardInterrupt:\n                exit()\n                \n    # random piano mode\n    if args.piano:\n        while True:\n            for event in pygame.event.get():\n                if (event.type == pygame.KEYUP):\n                    print(\"key pressed\")\n                    nplayer.playRandom()\n                    time.sleep(0.5)\n                    \n# call main\nif __name__ == '__main__':\n    main()\n\n","lang":"python","filename":"ks.py","key":"c4pVILv93D"}],"key":"ID7WZxDMmY"}],"key":"Hbr912a6iI"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The program above was rewritten and into a Jupyter Notebook format and upgraded with in browser functionality.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"qKkjhFpATF"}],"key":"qgtvgJaecU"}],"key":"g9EuAUz1TU"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Jupyter Notebook Implementation","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RTKdM7JwUp"}],"identifier":"jupyter-notebook-implementation","label":"Jupyter Notebook Implementation","html_id":"jupyter-notebook-implementation","implicit":true,"key":"hC1rWkK7jE"}],"key":"dOyuICzDM7"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%matplotlib inline\nimport os\nimport time, random\nimport wave, argparse, pygame\nimport numpy as np\nfrom collections import deque\nfrom matplotlib import pyplot as plt","key":"rZvst6gS4B"},{"type":"outputs","id":"ya9tMBEI0Gqagfb0jSemN","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"pygame 2.5.2 (SDL 2.28.5, Python 3.10.13)\nHello from the pygame community. https://www.pygame.org/contribute.html\n"},"children":[],"key":"FXfGfObuqz"}],"key":"pFAcR2kS6G"}],"key":"VXcEXpWRFo"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# notes of a Pentatonic Minor Scale\n# piano C4-E(b)-F-G-B(b)-C5\npmNotes = {'C4': 262, 'Eb': 311, 'F': 349, 'G': 391, 'Bb': 466}","key":"K3QnMpi2xi"},{"type":"outputs","id":"-imQQucectdQKkl5Eot4A","children":[],"key":"f2TKoj6z2z"}],"key":"vVpE1tUuaY"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def writeWAVE(fname, data):\n    # open file\n    file = wave.open(fname, 'wb')\n    # WAV file parameters\n    nChannels = 1\n    sampleWidth = 2\n    frameRate = 44100\n    nFrames = 44100\n    # set parameters\n    file.setparams((nChannels, sampleWidth, frameRate, nFrames, 'NONE', 'noncompressed'))\n    file.writeframes(data)\n    file.close","key":"I5fsxOnp6K"},{"type":"outputs","id":"2MIN8rEkuaYDfN6XGBVW9","children":[],"key":"Hs0YEaGMWB"}],"key":"POlPEOsYKg"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# generate note of given frequency\ndef generateNote(freq):\n    nSamples = 44100\n    sampleRate = 44100\n    N = int(sampleRate / freq)\n    \n    # initialize ring buffer\n    buf = deque([random.random() - 0.5 for i in range(N)])\n    \n    # initialize sample buffer\n    samples = np.array([0]*nSamples, 'float32')\n    for i in range(nSamples):\n        samples[i] = buf[0]\n        avg = 0.995 * 0.5 * (buf[0] + buf[1])\n        buf.append(avg)\n        buf.popleft()\n        \n    # convert samples to 16-bit values and then to a string\n    # the maximum value is 32767 for 16-bit\n    samples = np.array(samples*32767, 'int16')\n    return samples.tobytes(), buf","key":"NHito4rGL3"},{"type":"outputs","id":"Kt6RXj_BQaJFwTJ6bbnvU","children":[],"key":"zn6qBHasTg"}],"key":"CUjnagwCM3"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# play a WAV file\nclass NotePlayer:\n    # constructor\n    def __init__(self):\n        pygame.mixer.pre_init(44100, -16, 1, 2048)\n        pygame.init()\n        # dictionary of notes\n        self.notes = {}\n    \n    # add a note\n    def add(self, fileName):\n        self.notes[fileName] = pygame.mixer.Sound(fileName)\n    \n    # play a note\n    def play(self, fileName):\n        try:\n            self.notes[fileName].play()\n        except:\n            print(fileName + ' not found!')\n            \n    def playRandom(self):\n        \"\"\" play a random note \"\"\"\n        index = random.randint(0, len(self.notes)-1)\n        note = list(self.notes.values())[index]\n        note.play()","key":"ZCQoZQtZfY"},{"type":"outputs","id":"I861-QTzENfF6GjIBvWQQ","children":[],"key":"GIS1hwQUTS"}],"key":"hMw7QgdNJU"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# create note player\nnplayer = NotePlayer()","key":"EkrZLxO30O"},{"type":"outputs","id":"4o-iTb3t-W119F3_6rZCf","children":[],"key":"Wo4tl3tmiD"}],"key":"ML6reCzvmr"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Create and Plot Note Samples","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HTzCrZ0Bu8"}],"identifier":"create-and-plot-note-samples","label":"Create and Plot Note Samples","html_id":"create-and-plot-note-samples","implicit":true,"key":"w6yh0Jq3g5"}],"key":"FwKWF5BLkM"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print('creating notes...')\nfor name, freq in list(pmNotes.items()):\n    fileName = name +'.wav'\n    data, buf = generateNote(freq)\n    print('creating ' + fileName + '...')\n    writeWAVE(fileName, data)\n    # Display the Notes\n    ax = plt.plot(buf, label=name)\n\n    # add note to player\n    nplayer.add(name + '.wav')\n    plt.legend()\n    plt.xlabel(\"Sample Number\")\n    plt.ylabel(\"Amplitude\")\n    plt.title(\"Generated Notes\")","key":"JfkD2NFeyz"},{"type":"outputs","id":"fpIbkF1Xs3LHuOv5gTpOp","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"creating notes...\ncreating C4.wav...\ncreating Eb.wav...\ncreating F.wav...\ncreating G.wav...\ncreating Bb.wav...\n"},"children":[],"key":"r4q2dfnb6c"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"b993eb656c4f1761b5bf060e0b563d99","path":"/build/b993eb656c4f1761b5bf060e0b563d99.png"},"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"Xc4eOml3M8"}],"key":"I26bsusEMa"}],"key":"hLd84PSsTh"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# List all files in the directory and filter for .wav files\ndirectory_path = os.getcwd()\nwav_files = [f for f in os.listdir(directory_path) if f.endswith('.wav')]","key":"PCBJdB3neH"},{"type":"outputs","id":"m92VcixNvYc_VyxqE0yLo","children":[],"key":"kpAURtnGle"}],"key":"deVpsMHl07"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"wav_files","key":"C4qNBc3qxv"},{"type":"outputs","id":"UJw28oGV7m_Wr27cOy6S0","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":9,"metadata":{},"data":{"text/plain":{"content":"['Bb.wav', 'C4.wav', 'Eb.wav', 'F.wav', 'G.wav']","content_type":"text/plain"}}},"children":[],"key":"omayx8G5ww"}],"key":"prFuOYbs4K"}],"key":"gx0dOFNHgw"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot and Play Note Wavfile Data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"sBaAA9XwFE"}],"identifier":"plot-and-play-note-wavfile-data","label":"Plot and Play Note Wavfile Data","html_id":"plot-and-play-note-wavfile-data","implicit":true,"key":"XxbF8PAl7M"}],"key":"cqtjuVEwah"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%matplotlib ipympl\nfrom IPython.display import Audio, display\nfrom scipy.io import wavfile\n\nfor wav_file in wav_files:\n    file_path = os.path.join(directory_path, wav_file)\n    sampling_rate, data = wavfile.read(file_path)\n    # Check if the audio is mono or stereo and extract accordingly\n    if len(data.shape) > 1:  # Stereo\n        data = data.mean(axis=1)  # Convert to mono by averaging left and right channels\n\n    # Create a time axis in seconds\n    time = np.linspace(0, len(data) / sampling_rate, num=len(data))\n\n    # Plotting\n    plt.figure(figsize=(8, 4))\n    plt.plot(time, data)\n    plt.title('Waveform of .wav file')\n    plt.xlabel('Time [s]')\n    plt.ylabel('Amplitude')\n    plt.xlim(0, 0.05)\n    plt.show()\n    \n    display(Audio(filename=file_path))\n    print(f\"Playing file: {wav_file}\")\n    print()","key":"NhZhHoNIcf"},{"type":"outputs","id":"dpdiQHHuWZ5o8jk1eCwZK","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"application/vnd.jupyter.widget-view+json":{"content":"{\"model_id\":\"e3185e8c5e0747d0af6e9ca46d7cd6e8\",\"version_major\":2,\"version_minor\":0}","content_type":"application/vnd.jupyter.widget-view+json"},"image/png":{"content_type":"image/png","hash":"bfbd05a2e379583da5f355a7ce0c5b98","path":"/build/bfbd05a2e379583da5f355a7ce0c5b98.png"},"text/html":{"content_type":"text/html","hash":"e91d2e0204929a8a30d504fe6abf6c95","path":"/build/e91d2e0204929a8a30d504fe6abf6c95.html"},"text/plain":{"content":"Canvas(toolbar=Toolbar(toolitems=[('Home', 'Reset original view', 'home', 'home'), ('Back', 'Back to previous …","content_type":"text/plain"}}},"children":[],"key":"yGVtA9KfQG"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"2b72e0b62d1fb67cf54e52ceb0628fce","path":"/build/2b72e0b62d1fb67cf54e52ceb0628fce.html"},"text/plain":{"content":"<IPython.lib.display.Audio object>","content_type":"text/plain"}}},"children":[],"key":"tNoeKGZGrM"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Playing file: Bb.wav\n\n"},"children":[],"key":"usSZikZ2c9"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"application/vnd.jupyter.widget-view+json":{"content":"{\"model_id\":\"b5c9f757602648a288fea103c49149b7\",\"version_major\":2,\"version_minor\":0}","content_type":"application/vnd.jupyter.widget-view+json"},"image/png":{"content_type":"image/png","hash":"ad17195bb4f8653f1128dde906969d15","path":"/build/ad17195bb4f8653f1128dde906969d15.png"},"text/html":{"content_type":"text/html","hash":"d6171ebc30e96cd3bf27afb5194ca460","path":"/build/d6171ebc30e96cd3bf27afb5194ca460.html"},"text/plain":{"content":"Canvas(toolbar=Toolbar(toolitems=[('Home', 'Reset original view', 'home', 'home'), ('Back', 'Back to previous …","content_type":"text/plain"}}},"children":[],"key":"XdD5mDGFhk"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"40cb48e75f8b4db2c4a8bb9211513d0d","path":"/build/40cb48e75f8b4db2c4a8bb9211513d0d.html"},"text/plain":{"content":"<IPython.lib.display.Audio object>","content_type":"text/plain"}}},"children":[],"key":"RXL3f2iHiY"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Playing file: C4.wav\n\n"},"children":[],"key":"yjqPw8GY25"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"application/vnd.jupyter.widget-view+json":{"content":"{\"model_id\":\"7a0bf0b4c45d4f97aba989ad3af82a4c\",\"version_major\":2,\"version_minor\":0}","content_type":"application/vnd.jupyter.widget-view+json"},"image/png":{"content_type":"image/png","hash":"856023e27b53ccef71ba24b33f316ec1","path":"/build/856023e27b53ccef71ba24b33f316ec1.png"},"text/html":{"content_type":"text/html","hash":"ec9fd04d4ea7f054904724fc1cc9ad65","path":"/build/ec9fd04d4ea7f054904724fc1cc9ad65.html"},"text/plain":{"content":"Canvas(toolbar=Toolbar(toolitems=[('Home', 'Reset original view', 'home', 'home'), ('Back', 'Back to previous …","content_type":"text/plain"}}},"children":[],"key":"vtBTLMeuZk"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"5607866cb53346d4610e6ec77365f03d","path":"/build/5607866cb53346d4610e6ec77365f03d.html"},"text/plain":{"content":"<IPython.lib.display.Audio object>","content_type":"text/plain"}}},"children":[],"key":"dRp73H5i5P"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Playing file: Eb.wav\n\n"},"children":[],"key":"S0NNJg4ysL"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"application/vnd.jupyter.widget-view+json":{"content":"{\"model_id\":\"6faa31d1e99d48f6aef445ebbb437d78\",\"version_major\":2,\"version_minor\":0}","content_type":"application/vnd.jupyter.widget-view+json"},"image/png":{"content_type":"image/png","hash":"5c53cd31fd70d537b9131c5b06e1ab45","path":"/build/5c53cd31fd70d537b9131c5b06e1ab45.png"},"text/html":{"content_type":"text/html","hash":"1409ef65b4fa35e4c47c0b4fce535546","path":"/build/1409ef65b4fa35e4c47c0b4fce535546.html"},"text/plain":{"content":"Canvas(toolbar=Toolbar(toolitems=[('Home', 'Reset original view', 'home', 'home'), ('Back', 'Back to previous …","content_type":"text/plain"}}},"children":[],"key":"x5HqprX8jU"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"d91acaa3795737032ec702c68cca0487","path":"/build/d91acaa3795737032ec702c68cca0487.html"},"text/plain":{"content":"<IPython.lib.display.Audio object>","content_type":"text/plain"}}},"children":[],"key":"B0QiXzYyeO"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Playing file: F.wav\n\n"},"children":[],"key":"bD8oKl24n2"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"application/vnd.jupyter.widget-view+json":{"content":"{\"model_id\":\"721a5d7201dd4c438e0b0aad5b310bd0\",\"version_major\":2,\"version_minor\":0}","content_type":"application/vnd.jupyter.widget-view+json"},"image/png":{"content_type":"image/png","hash":"b90d6eb76ba3e02d5696d83e8bc7dbc9","path":"/build/b90d6eb76ba3e02d5696d83e8bc7dbc9.png"},"text/html":{"content_type":"text/html","hash":"52e84ed9cf29c995f33a95cc977e4b4a","path":"/build/52e84ed9cf29c995f33a95cc977e4b4a.html"},"text/plain":{"content":"Canvas(toolbar=Toolbar(toolitems=[('Home', 'Reset original view', 'home', 'home'), ('Back', 'Back to previous …","content_type":"text/plain"}}},"children":[],"key":"oEG0H4dTQy"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"519bc9c3f5d983659e8ce5aaeb22b6a9","path":"/build/519bc9c3f5d983659e8ce5aaeb22b6a9.html"},"text/plain":{"content":"<IPython.lib.display.Audio object>","content_type":"text/plain"}}},"children":[],"key":"x7CiCUNlR7"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Playing file: G.wav\n\n"},"children":[],"key":"T1gtPXUYIN"}],"key":"CMw4rfofCZ"}],"key":"ZGA6mgnXVU"}],"key":"mmrzOXYiK0"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Chapter 3: Conway’s Game of Life","url":"/sections/computer-programming/python/python-playground/section-chapter-3-conway","group":"Computer Programming"},"next":{"title":"IPyWidgets: Using Interact","url":"/sections/computer-programming/jupyter-widgets/using-interact","group":"Computer Programming"}}},"domain":"http://localhost:3008"}