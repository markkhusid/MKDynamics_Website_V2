{"version":3,"kind":"Notebook","sha256":"187b92ac3da3ac54267da6378c70af25843320cd8a2773a2210f5d784adc1c21","slug":"sections.computer-programming.fortran.modern-fortran.tsunami-simulator-with-modules","location":"/Sections/Computer_Programming/Fortran/Modern_Fortran/Tsunami_Simulator_with_Modules.ipynb","dependencies":[],"frontmatter":{"title":"Tsunami Simulator with Modules","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"authors":[{"nameParsed":{"literal":"Mark Khusid","given":"Mark","family":"Khusid"},"name":"Mark Khusid","id":"contributors-myst-generated-uid-0"}],"github":"https://github.com/markkhusid/MKDynamics_Website_V2","numbering":{"title":{"offset":4}},"source_url":"https://github.com/markkhusid/MKDynamics_Website_V2/blob/master/Sections/Computer_Programming/Fortran/Modern_Fortran/Tsunami_Simulator_with_Modules.ipynb","edit_url":"https://github.com/markkhusid/MKDynamics_Website_V2/edit/master/Sections/Computer_Programming/Fortran/Modern_Fortran/Tsunami_Simulator_with_Modules.ipynb","exports":[{"format":"ipynb","filename":"Tsunami_Simulator_with_Modules.ipynb","url":"/build/Tsunami_Simulator_wi-cdc1558144e962fe4d715b988dbdf9b3.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Adapted from: “","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"I3BZctUG86"},{"type":"link","url":"https://www.manning.com/books/modern-fortran","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Modern Fortran: Building Efficient Parallel Applications","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"sMBjrXsHEZ"}],"urlSource":"https://www.manning.com/books/modern-fortran","key":"ELbQWlVF1n"},{"type":"text","value":"” by Milan Curcic (Manning)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"nOLzolQS33"}],"key":"dlgf2mTe7n"}],"key":"QC0drH8rZ7"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Program to Calculate the Temperature due to a Cold Front Using a Loop","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"GX5MIwy4rd"}],"identifier":"program-to-calculate-the-temperature-due-to-a-cold-front-using-a-loop","label":"Program to Calculate the Temperature due to a Cold Front Using a Loop","html_id":"program-to-calculate-the-temperature-due-to-a-cold-front-using-a-loop","implicit":true,"key":"IW3cgBCVuB"}],"key":"yaB4gmWjas"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"In this section the Tsunami Simulator is rewritten using Fortran Modules.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"E37mHue3Ab"}],"key":"umNlEjcc7E"}],"key":"LErVfVFuBO"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The file mod_inital.f08 contains:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"wbWyBefwju"}],"identifier":"the-file-mod-inital-f08-contains","label":"The file mod_inital.f08 contains:","html_id":"the-file-mod-inital-f08-contains","implicit":true,"key":"gf0aUaKNz6"}],"visibility":"show","key":"CZcTRlA7aw"},{"type":"block","kind":"notebook-content","children":[{"type":"include","file":"Fortran_Code/Tsunami_Simulator_with_Modules/src/mod_initial.f90","literal":true,"children":[{"type":"code","value":"module mod_initial\n    \n    private\n    public :: set_gaussian\n\ncontains\n    \n    pure subroutine set_gaussian(x, icenter, decay)\n        real, intent(in out) :: x(:)\n        integer, intent(in)  :: icenter\n        real, intent(in)     :: decay\n        \n        integer :: i\n    \n        do concurrent(i = 1:size(x))\n            x(i) = exp(-decay * (i - icenter)**2)\n        end do\n    end subroutine set_gaussian\n    \nend module mod_initial","lang":"fortran","filename":"mod_initial.f90","key":"bbB1uyx2Ku"}],"key":"DZ5ktVui3j"}],"key":"HfFsksHbm5"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The file mod_diff.f08 contains:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tQYX0Rk9f9"}],"identifier":"the-file-mod-diff-f08-contains","label":"The file mod_diff.f08 contains:","html_id":"the-file-mod-diff-f08-contains","implicit":true,"key":"DSwwOjvzqi"}],"visibility":"show","key":"kUSFckDMRw"},{"type":"block","kind":"notebook-content","children":[{"type":"include","file":"Fortran_Code/Tsunami_Simulator_with_Modules/src/mod_diff.f90","literal":true,"children":[{"type":"code","value":"! %module magic necessary so that jupyter fortran kernel knows that \n! the code below is to be compiled as a module and not executable code.\n!%module: mod_diff \nmodule mod_diff\n\n    use iso_fortran_env, only: int32, real32\n    implicit none\n    \n    private\n    public :: diff_upwind, diff_centered\n    \ncontains\n\n    pure function diff_upwind(x) result(dx)\n        real(real32), intent(in) :: x(:)\n        real(real32)             :: dx(size(x))\n        integer(int32)           :: im\n        \n        im       = size(x)\n        dx(1)    = x(1) - x(im)\n        dx(2:im) = x(2:im) - x(1:im - 1)\n    end function diff_upwind\n    \n    pure function diff_centered(x) result(dx)\n        real(real32), intent(in) :: x(:)\n        real(real32)             :: dx(size(x))\n        integer(int32)           :: im\n        \n        im         = size(x)\n        dx(1)      = x(2) - x(im)\n        dx(im)     = x(1) - x(im - 1)\n        dx(2:im-1) = x(3:im) - x(1:im-2)\n    end function diff_centered\n    \nend module mod_diff","lang":"fortran","filename":"mod_diff.f90","key":"TIWOmaEKeF"}],"key":"Sjba4assAS"}],"key":"FmHuCRNTya"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Main Program","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Ob0Bh92oQy"}],"identifier":"main-program","label":"Main Program","html_id":"main-program","implicit":true,"key":"tuKoPEzjB4"}],"key":"IoxUz677MD"},{"type":"block","kind":"notebook-content","children":[{"type":"include","file":"Fortran_Code/Tsunami_Simulator_with_Modules/app/tsunami_simulator_with_modules.f90","literal":true,"children":[{"type":"code","value":"program tsunami\n\n    use iso_fortran_env, only : int32, real32\n    use mod_diff, only        : diff => diff_centered\n    use mod_initial, only     : set_gaussian\n    \n    implicit none\n    \n    integer(int32) :: n\n    \n    integer(int32), parameter :: grid_size = 100\n    integer(int32), parameter :: num_time_steps = 5000\n    real(real32),   parameter :: dt = 0.02, dx = 1, g = 9.8\n    real(real32),   parameter :: hmean = 10\n    \n    real(real32)              :: h(grid_size), u(grid_size)\n    \n    integer(int32), parameter :: icenter = 25\n    real(real32), parameter   :: decay = 0.02\n    \n    logical :: file_exists\n    \n    open(9, file = 'tsunami_simulator_with_modules_data.txt')\n    \n    if (grid_size <= 0) stop 'grid_size must be > 0'\n    if (dt <= 0) stop 'time step dt must be > 0'\n    if (dx <= 0) stop 'grid spacing dx must be > 0'\n    \n    call set_gaussian(h, icenter, decay)\n    u = 0\n    \n    !print *, 0, h\n    write (9, *) 0, h\n    close(9)\n    \n    time_loop: do n = 1, num_time_steps\n        \n        u = u - (u * diff(u) + g * diff(h)) / dx * dt\n        h = h - diff(u * (hmean + h)) / dx * dt\n        \n        !print *, n, h\n        \n        inquire(file = 'tsunami_simulator_with_modules_data.txt', exist = file_exists)\n        if (file_exists) then\n            open(9, file = 'tsunami_simulator_with_modules_data.txt', status = 'old', position = 'append', action = 'write')\n        else\n            open(9, file = 'tsunami_simulator_with_modules_data.txt', status = \"new\", action = 'write')\n        end if\n        \n        write (9, *) n, h\n\n    end do time_loop\n     \n    close(9)\n    \nend program tsunami\n","lang":"fortran","filename":"tsunami_simulator_with_modules.f90","key":"Wc7pOec71O"}],"key":"gKjidxzzYU"}],"key":"ltHYptGC8Z"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Program Explanation","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vmFlm8kd97"}],"identifier":"program-explanation","label":"Program Explanation","html_id":"program-explanation","implicit":true,"key":"xDh2crAdPq"}],"key":"SJSxbTc7fK"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The following explanation is given by “Code Copilot” within ChatGPT 4.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rsnNeXjG4j"}],"key":"JL5e2CtS1e"}],"key":"EAYhoalX0Y"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The Fortran module ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QKVIzp0eM7"},{"type":"inlineCode","value":"mod_diff.f90","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RAePQRo5Kg"},{"type":"text","value":" defines a module named ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rbLS9G96LU"},{"type":"inlineCode","value":"mod_diff","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HHkQLwfCrs"},{"type":"text","value":" that provides numerical differentiation functionalities tailored for use in simulations or numerical methods. Here’s an overview of its content:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DGIr0JguNk"}],"key":"u7XuA0rFTp"},{"type":"heading","depth":3,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Module: ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"xycSGbsBWo"},{"type":"inlineCode","value":"mod_diff","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"TO51XvirsF"}],"identifier":"module-mod-diff","label":"Module: mod_diff","html_id":"module-mod-diff","implicit":true,"key":"z7dBWpXELO"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":4,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Dependencies","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"eXcjCFTayZ"}],"key":"dyA5gyhE7X"},{"type":"text","value":": It uses the standard Fortran module ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"PgLhwEeAzr"},{"type":"inlineCode","value":"iso_fortran_env","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"QK1s4L47bj"},{"type":"text","value":" for access to predefined kinds like ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"RSdWgzcKrY"},{"type":"inlineCode","value":"int32","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"aweBUFa7zo"},{"type":"text","value":" for integers and ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"PDy2sgffK2"},{"type":"inlineCode","value":"real32","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"BB4rLnY1Wb"},{"type":"text","value":" for single-precision floating-point numbers.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"mFiMkveijY"}],"key":"s5aE9NQLuk"}],"key":"pqaxLLK6km"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Functions","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"tqkl5hQC6q"}],"key":"XYnXn57jZK"},{"type":"text","value":":","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"cBdxUQYeA5"}],"key":"ddN15tLkaC"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":6,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"diff_upwind(x)","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"Xn4rLrE8YO"},{"type":"text","value":": This function implements the upwind differencing scheme. It is used to approximate derivatives in problems where information propagates in one direction (like fluid flow in one direction). The output ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"fzghvd3B6E"},{"type":"inlineCode","value":"dx","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"at5ItciIN7"},{"type":"text","value":" is a vector where each element is calculated as the difference between consecutive elements of the input vector ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"Ec5NKX0qic"},{"type":"inlineCode","value":"x","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"fJ3HINhd5a"},{"type":"text","value":", except the first element, which is the difference between the first and last elements, simulating a wrap-around or periodic boundary condition.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"xnsukrHzKL"}],"key":"cCFltEFWZq"}],"key":"Or1hOGtxnE"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"diff_centered(x)","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"s1eYh9Gju6"},{"type":"text","value":": This function implements the centered differencing scheme, which is more accurate but also more sensitive to numerical errors. The function computes differences such that each element of the result ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"aTTH5dcFlZ"},{"type":"inlineCode","value":"dx","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"P8d1FBQ20h"},{"type":"text","value":" is the difference between elements of ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"trZTxaYQ3H"},{"type":"inlineCode","value":"x","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"lMLmVucgeq"},{"type":"text","value":" that are one step apart, with special handling for the first and last elements to manage boundary effects.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"m8jMMJdl3U"}],"key":"TBRXOl6RnP"}],"key":"Naty2ch82P"}],"key":"gvuxmTfGXc"}],"key":"Y8uPxN6hkv"}],"key":"Zu4nEgqGxz"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"These functions are declared as ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"IU3Vv1uuTo"},{"type":"inlineCode","value":"pure","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"enpftzqd5c"},{"type":"text","value":", which in Fortran ensures that they do not have side-effects, an essential property for functions that are intended to be used in parallel computations or where determinism is critical.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"MreUs3uSjO"}],"key":"rELQf94Mll"},{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Both functions are designed to operate on arrays of single-precision floating-point numbers, indicating their intended use in applications where performance and memory usage are balanced against the precision of calculations.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"MG5SUPJavP"}],"key":"qcqR4Kwiv4"},{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"This module can be used in larger Fortran programs or simulations where numerical differentiation is required, such as in fluid dynamics, weather modeling, or other computational physics simulations.","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"ORnmbzeeQ6"}],"key":"x5QeiiwgCM"},{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Let’s proceed to analyze the other files for a complete understanding of the entire program.","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"DgN170cwUI"}],"key":"iT6lNZ0Jcw"},{"type":"paragraph","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"The Fortran module ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"Fale10s4v2"},{"type":"inlineCode","value":"mod_initial.f90","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"cBfDbIxqvr"},{"type":"text","value":" defines a module named ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"UY2HUTBs3U"},{"type":"inlineCode","value":"mod_initial","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"T8JkNuU49e"},{"type":"text","value":" that includes functionality for initializing arrays based on specific patterns. Here’s an overview of its content:","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"XIIz1po4y0"}],"key":"NeT0kdjKWf"},{"type":"heading","depth":3,"position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"Module: ","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"uOo8parTCW"},{"type":"inlineCode","value":"mod_initial","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"fMRAaExWQ8"}],"identifier":"module-mod-initial","label":"Module: mod_initial","html_id":"module-mod-initial","implicit":true,"key":"it5KgcpdUl"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":20,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":20,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"Subroutine","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"flgZraSJaH"}],"key":"SgR1wFSouW"},{"type":"text","value":":","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"Su1t46hBhT"}],"key":"VcPnH9lrHu"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":21,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":21,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"set_gaussian(x, icenter, decay)","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"fDFeJ17Zv1"},{"type":"text","value":": This subroutine initializes an array ","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"xJaynUZGVv"},{"type":"inlineCode","value":"x","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"RwhViCNlrL"},{"type":"text","value":" with a Gaussian (or normal distribution) curve centered at the index ","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"vnYsKDDAes"},{"type":"inlineCode","value":"icenter","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"wASGGeFb87"},{"type":"text","value":" with a specified ","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"WYkIa12kyx"},{"type":"inlineCode","value":"decay","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"VhmamXdu52"},{"type":"text","value":" rate. This pattern is commonly used in simulations for setting initial conditions where phenomena like wave packets or other localized features are described.","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"I4ywaOva9r"}],"key":"L9lua1qRuj"}],"key":"jZZQEmeNUW"}],"key":"OYSXqiGtka"}],"key":"iHxKbjSu3a"}],"key":"lPAQGm76Ig"},{"type":"heading","depth":3,"position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"Details:","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"jY13zTaTnr"}],"identifier":"details","label":"Details:","html_id":"details","implicit":true,"key":"ngN2hlGuR6"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":24,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"Input/Output","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"u961iuShXU"}],"key":"GeyWw7EXPA"},{"type":"text","value":": The subroutine operates directly on the array ","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"x0cD8wDQfg"},{"type":"inlineCode","value":"x","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"HEZyoivUrH"},{"type":"text","value":" passed to it, modifying it in place (as indicated by ","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"MOiyYAgvDA"},{"type":"inlineCode","value":"intent(in out)","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"J0glLsN0UE"},{"type":"text","value":"). This approach is typical in Fortran where arrays are often modified directly rather than returned.","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"mHInmxADD7"}],"key":"BgSoqCHc78"}],"key":"AQYqKOgUiU"},{"type":"listItem","spread":true,"position":{"start":{"line":25,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"text","value":"Parameters","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"FsQUHJEdJi"}],"key":"YCdp6YiDRH"},{"type":"text","value":":","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"p0s2jN1jwZ"}],"key":"EoIOcQK0Qe"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":26,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"icenter","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"KFJATXn7NA"},{"type":"text","value":": An integer specifying the center position of the Gaussian distribution within the array.","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"HdMwIC9MCV"}],"key":"XrPAsDOi1l"}],"key":"nRkxh4xtkw"},{"type":"listItem","spread":true,"position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"decay","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"PEx4n7TF7N"},{"type":"text","value":": A real number that controls the width of the bell curve; higher values make the curve narrower.","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"MlMVq5S9UJ"}],"key":"eHe7T3N1JD"}],"key":"YZzQ7HY02z"}],"key":"fWGhdpUj3c"}],"key":"IqwQGqLOnp"},{"type":"listItem","spread":true,"position":{"start":{"line":28,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"text","value":"Loop","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"pfEUEHYSs0"}],"key":"CU2LinRZOI"},{"type":"text","value":":","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"YOb8YeFp0w"}],"key":"AaloBnRA4F"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":29,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":29,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The Gaussian values are computed using a concurrent loop (","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"DrYpe9QB1z"},{"type":"inlineCode","value":"do concurrent","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"ZBVLQPPls9"},{"type":"text","value":"), which allows for parallel computation where supported. Each element ","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"QFbDy6Qe1A"},{"type":"inlineCode","value":"x(i)","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"cmFLYqX5lH"},{"type":"text","value":" is set to ","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"NEaaKwtDO3"},{"type":"inlineCode","value":"exp(-decay * (i - icenter)**2)","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"FNPE8IFl2Q"},{"type":"text","value":", which is the formula for a Gaussian function.","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"sN9SY23mYB"}],"key":"GZfICRIopp"}],"key":"ywdN2Xb7pQ"}],"key":"FXhtdIzl2E"}],"key":"eY4D2MRcTj"}],"key":"X3O3l0ASeX"},{"type":"paragraph","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"text","value":"This module is particularly useful in simulations where initial conditions need to be defined in a spatially varying manner, such as setting up initial wave conditions in a medium or initial concentration distributions in simulations of diffusion processes.","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"SWruzpJ1aT"}],"key":"pEbtzovRH8"},{"type":"paragraph","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"children":[{"type":"text","value":"We will next examine the main program file ","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"MTpwlU3nuV"},{"type":"inlineCode","value":"tsunami_simulator_with_modules.f90","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"ertxp8Y1gE"},{"type":"text","value":" to understand how these modules are utilized in a larger context.","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"sC4fGeQTPW"}],"key":"MwKyebpMgQ"},{"type":"paragraph","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"children":[{"type":"text","value":"The Fortran program ","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"MnmomAVN1z"},{"type":"inlineCode","value":"tsunami_simulator_with_modules.f90","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"ihe6Cg6onr"},{"type":"text","value":" implements a simple model for simulating tsunami waves using numerical methods. Here’s a detailed explanation of the program:","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"T4czVKpinJ"}],"key":"ILQlpjOsjQ"},{"type":"heading","depth":3,"position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"text","value":"Program Structure:","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"RAUkzJOWQl"}],"identifier":"program-structure","label":"Program Structure:","html_id":"program-structure","implicit":true,"key":"mCj6vjYaWH"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":38,"column":1},"end":{"line":51,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":38,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"text","value":"Modules Used","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"twB97Nnv8I"}],"key":"koO227PMg2"},{"type":"text","value":":","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"arnH97ARKY"}],"key":"nZbGnXAwSZ"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":39,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"mod_diff","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"xzpaiK0MHW"},{"type":"text","value":": Provides the ","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"qZpJBHOnCa"},{"type":"inlineCode","value":"diff_centered","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"sG0wf1mpuS"},{"type":"text","value":" function for numerical differentiation.","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"wnHwH4sBfs"}],"key":"PhS5muoxzn"}],"key":"m6kjchIplk"},{"type":"listItem","spread":true,"position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"mod_initial","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"GgXCCkJ1gf"},{"type":"text","value":": Contains the ","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"VyKjnh06mm"},{"type":"inlineCode","value":"set_gaussian","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"i5X5WJBURm"},{"type":"text","value":" subroutine for initializing wave heights.","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"Nwg1fXtuo2"}],"key":"X2SX5FRWYC"}],"key":"B18sRU1nKg"}],"key":"iGnZ6PseF9"}],"key":"IEmhG3lsrj"},{"type":"listItem","spread":true,"position":{"start":{"line":41,"column":1},"end":{"line":51,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"children":[{"type":"text","value":"Main Variables","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"key":"oBDSdmD0ae"}],"key":"umyuUMprfa"},{"type":"text","value":":","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"key":"uaRL8KFm2a"}],"key":"p2aHoll9Jz"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":42,"column":1},"end":{"line":51,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"grid_size","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"KSgI6ZdcEh"},{"type":"text","value":": Defines the size of the grid (number of spatial points).","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"VvkF4xqjau"}],"key":"IwQfGgDXCc"}],"key":"yBoZ2PYfCG"},{"type":"listItem","spread":true,"position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"num_time_steps","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"key":"RCBq4gEXJI"},{"type":"text","value":": Specifies the number of time steps for the simulation.","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"key":"qOdI5JcR1e"}],"key":"UyF7A3VgSD"}],"key":"GIAWdG881i"},{"type":"listItem","spread":true,"position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"dt","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"key":"eNVjgVjmjq"},{"type":"text","value":": Time step increment.","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"key":"qeuuj6IOym"}],"key":"aXyILPCmmD"}],"key":"dPlycR3juz"},{"type":"listItem","spread":true,"position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"dx","position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"key":"wV5VrU1MX4"},{"type":"text","value":": Spatial step increment.","position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"key":"BqY7ctsxkB"}],"key":"kPHbDeH0Ex"}],"key":"tPWSbRbpJ4"},{"type":"listItem","spread":true,"position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"g","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"JJ1PINuSMb"},{"type":"text","value":": Gravitational constant (approximately 9.8 m/s²).","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"zj3UTfh7XW"}],"key":"FWlmywFMtI"}],"key":"b1mfCSyUAW"},{"type":"listItem","spread":true,"position":{"start":{"line":47,"column":1},"end":{"line":47,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"hmean","position":{"start":{"line":47,"column":1},"end":{"line":47,"column":1}},"key":"bUWHFUtqBq"},{"type":"text","value":": Mean height of the ocean layer.","position":{"start":{"line":47,"column":1},"end":{"line":47,"column":1}},"key":"dyLs4Nhrmh"}],"key":"l19WF0jE24"}],"key":"qWZWDpT0Xt"},{"type":"listItem","spread":true,"position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"h","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"key":"MlTqOHMEc1"},{"type":"text","value":": Array representing the height of the wave at each grid point.","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"key":"oI9tFS1ug0"}],"key":"bYyMWNqln9"}],"key":"wY6lvMvW5F"},{"type":"listItem","spread":true,"position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"u","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"key":"XiLBygH26l"},{"type":"text","value":": Array representing the velocity of the wave at each grid point.","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"key":"BbSTPI2aeL"}],"key":"rACzujS7L3"}],"key":"Itajy8pOZd"},{"type":"listItem","spread":true,"position":{"start":{"line":50,"column":1},"end":{"line":51,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"icenter","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"key":"acEve6ZNuX"},{"type":"text","value":" and ","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"key":"U3dQvIYT7f"},{"type":"inlineCode","value":"decay","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"key":"uqUwduLAIw"},{"type":"text","value":": Parameters for the initial Gaussian distribution of the wave.","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"key":"sXINa3CoU2"}],"key":"yBIW1vLbdU"}],"key":"WzF9UvvU85"}],"key":"EP2db6NCWC"}],"key":"FJJsWFYna2"}],"key":"dnutAzYp7C"},{"type":"heading","depth":3,"position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"children":[{"type":"text","value":"Operations:","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"key":"Rf656GttqV"}],"identifier":"operations","label":"Operations:","html_id":"operations","implicit":true,"key":"y7nKD7oOkQ"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":53,"column":1},"end":{"line":59,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"children":[{"type":"text","value":"Initial Conditions","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"DxBGgtkJEz"}],"key":"Rw4TfjVyZs"},{"type":"text","value":": The water height array ","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"FLe3ttDmaW"},{"type":"inlineCode","value":"h","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"aC6oxQHc3S"},{"type":"text","value":" is initialized using a Gaussian distribution centered at ","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"lwaZaTqRt6"},{"type":"inlineCode","value":"icenter","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"UiQgwqY1Rx"},{"type":"text","value":" with a decay specified by ","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"Y1d14uN86I"},{"type":"inlineCode","value":"decay","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"N1vEfBx96S"},{"type":"text","value":". The velocity array ","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"ycyQGgFwIF"},{"type":"inlineCode","value":"u","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"c7os6ghaXp"},{"type":"text","value":" is initialized to zero.","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"I262tvmcTl"}],"key":"mDpjt8TRls"}],"key":"Ctfs1YFjf0"},{"type":"listItem","spread":true,"position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"children":[{"type":"text","value":"Output File","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"zAgiBwFqjq"}],"key":"T4sKEHExR5"},{"type":"text","value":": Data is initially written to a file ","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"Za9qhlvlhu"},{"type":"inlineCode","value":"tsunami_simulator_with_modules_data.txt","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"aarQ6tkPQ6"},{"type":"text","value":", and the wave height at each time step is appended to this file.","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"pkYCTKCZcR"}],"key":"iSnIDYqlN6"}],"key":"uVZtgWbsk2"},{"type":"listItem","spread":true,"position":{"start":{"line":55,"column":1},"end":{"line":57,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"children":[{"type":"text","value":"Simulation Loop (","position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"key":"ZDB2Lh4ybY"},{"type":"inlineCode","value":"time_loop","position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"key":"L22gZ3wFZp"},{"type":"text","value":")","position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"key":"k28eIoVADD"}],"key":"KJNwe40alg"},{"type":"text","value":":","position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"key":"C7xlh2w15q"}],"key":"vyLRutLaAH"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":56,"column":1},"end":{"line":57,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The velocities (","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"key":"m1nsWxNV3k"},{"type":"inlineCode","value":"u","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"key":"vn0U0QWOzM"},{"type":"text","value":") are updated based on the gradient of the velocities and heights. The updates are scaled by ","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"key":"ODCHgu3ZAc"},{"type":"inlineCode","value":"dt/dx","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"key":"jo4mTw1ike"},{"type":"text","value":" to maintain stability and accuracy.","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"key":"RdrQuQoOXF"}],"key":"Tem7RRCkHV"}],"key":"eWMO7z5BfI"},{"type":"listItem","spread":true,"position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The heights (","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"ActpBg4Lcg"},{"type":"inlineCode","value":"h","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"a6HdoiWgul"},{"type":"text","value":") are updated based on the divergence of the product of velocity and the sum of mean height and wave height. This mimics the conservation of mass in a fluid.","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"KSx4p43wKR"}],"key":"TQ6xG3CpsF"}],"key":"rBBz9sTI20"}],"key":"Cm8MgLswt9"}],"key":"V6hWAPYfKk"},{"type":"listItem","spread":true,"position":{"start":{"line":58,"column":1},"end":{"line":59,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"children":[{"type":"text","value":"File Handling","position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"key":"DWvqKA8TOU"}],"key":"llny0wC0c0"},{"type":"text","value":": Checks if the output file exists and writes data accordingly. If the file does not exist, it is created.","position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"key":"W1nqRU2kkF"}],"key":"yUSl15cqlP"}],"key":"ZptMhfpuSr"}],"key":"EWEIl3OP6y"},{"type":"heading","depth":3,"position":{"start":{"line":60,"column":1},"end":{"line":60,"column":1}},"children":[{"type":"text","value":"Numerical Methods:","position":{"start":{"line":60,"column":1},"end":{"line":60,"column":1}},"key":"sx7mDojH3a"}],"identifier":"numerical-methods","label":"Numerical Methods:","html_id":"numerical-methods","implicit":true,"key":"PDpVJg5F22"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":61,"column":1},"end":{"line":63,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The simulation uses centered differences (","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"t263ep6KL1"},{"type":"inlineCode","value":"diff_centered","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"aOBuuBCkJD"},{"type":"text","value":" from ","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"gEWLimLIzN"},{"type":"inlineCode","value":"mod_diff","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"iqrPtuJL19"},{"type":"text","value":") to compute spatial derivatives. Centered differences provide a good balance between accuracy and numerical stability.","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"xaC1rMaZMe"}],"key":"ycgPEujuLN"}],"key":"ciPviUQGcn"},{"type":"listItem","spread":true,"position":{"start":{"line":62,"column":1},"end":{"line":63,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The time integration method appears to be a straightforward forward Euler method, which is simple but conditionally stable.","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"key":"m6b2ChHy3H"}],"key":"tIkjdbYWAf"}],"key":"D2H3dX5zUf"}],"key":"hrB7peklDl"},{"type":"paragraph","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"children":[{"type":"text","value":"This program is an example of how modular Fortran programming can be used to build clean and maintainable scientific simulations. The use of separate modules for different functionalities (like initial condition setting and differentiation) makes the code easier to manage and modify.","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"key":"CopInv6sgC"}],"key":"kjBM3RtfWR"}],"key":"sXf8r7X7Re"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Program Compilation and Execution","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"E6ByFqBevg"}],"identifier":"program-compilation-and-execution","label":"Program Compilation and Execution","html_id":"program-compilation-and-execution","implicit":true,"key":"Lg6bbBFlnn"}],"key":"ew6RLN7Mgc"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The above program is compiled and run using Fortran Package Manager (fpm):","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"n3GPHvKjSM"}],"key":"PkfmACmBzF"}],"key":"aabOiG1gqt"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-05-05T21:57:55.582253Z","iopub.status.busy":"2024-05-05T21:57:55.581949Z","iopub.status.idle":"2024-05-05T21:57:55.588012Z","shell.execute_reply":"2024-05-05T21:57:55.586918Z","shell.execute_reply.started":"2024-05-05T21:57:55.582233Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"import os\nroot_dir = os.getcwd()","key":"ASOYr3nNRO"},{"type":"outputs","id":"Kaxa8Tzy-NjccFxQkqNew","children":[],"key":"OiMQHdkAPu"}],"key":"d7jJPw6Wru"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-05-05T21:57:55.898418Z","iopub.status.busy":"2024-05-05T21:57:55.898099Z","iopub.status.idle":"2024-05-05T21:57:55.907163Z","shell.execute_reply":"2024-05-05T21:57:55.906033Z","shell.execute_reply.started":"2024-05-05T21:57:55.898398Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"code_dir = root_dir + \"/\" + \"Fortran_Code/Tsunami_Simulator_with_Modules\"","key":"nUCaDVALGK"},{"type":"outputs","id":"aCCMbb8r3n1wzuUQEQLFZ","children":[],"key":"sQTV1eWg4j"}],"key":"xONdCQqvSs"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-05-05T21:57:56.173466Z","iopub.status.busy":"2024-05-05T21:57:56.172932Z","iopub.status.idle":"2024-05-05T21:57:56.229434Z","shell.execute_reply":"2024-05-05T21:57:56.187307Z","shell.execute_reply.started":"2024-05-05T21:57:56.173441Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"os.chdir(code_dir)","key":"Z2tcBkerQk"},{"type":"outputs","id":"ZGLh5UZ1S44nTUfHmiUYX","children":[],"key":"I5YyER4eqD"}],"key":"K59G0sH9sr"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-05-05T21:57:56.459129Z","iopub.status.busy":"2024-05-05T21:57:56.458797Z","iopub.status.idle":"2024-05-05T21:57:56.498637Z","shell.execute_reply":"2024-05-05T21:57:56.497273Z","shell.execute_reply.started":"2024-05-05T21:57:56.459107Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"build_status = os.system(\"fpm build 2>/dev/null\")","key":"OhNGiFtcyl"},{"type":"outputs","id":"Ftg5GH7XnH5C8a7sVLZlw","children":[],"key":"fcf3EvNSjs"}],"key":"KMLxpkIsb4"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-05-05T21:57:56.769575Z","iopub.status.busy":"2024-05-05T21:57:56.766680Z","iopub.status.idle":"2024-05-05T21:57:57.245976Z","shell.execute_reply":"2024-05-05T21:57:57.245429Z","shell.execute_reply.started":"2024-05-05T21:57:56.769547Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"exec_status = os.system(\"fpm run 2>/dev/null\")","key":"AFFVb765xi"},{"type":"outputs","id":"1W1ZIewGbCh5hXnEGeevR","children":[],"key":"K7rn8kpNG3"}],"key":"MCD2HOUisZ"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The above Fortran code writes the calculations to a file called ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lLLvSCBgTY"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"tsunami_simulator_with_modules_data.txt","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"uCrnu9G4w5"}],"key":"KrXuz9FWkF"}],"key":"vHL8ZEAz0v"}],"key":"GluRWwcDyM"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-05-05T21:57:58.571172Z","iopub.status.busy":"2024-05-05T21:57:58.569949Z","iopub.status.idle":"2024-05-05T21:57:59.004675Z","shell.execute_reply":"2024-05-05T21:57:59.003752Z","shell.execute_reply.started":"2024-05-05T21:57:58.571147Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"import pandas as pd\noutput_filename = 'tsunami_simulator_with_modules_data.txt'\ndata_file = code_dir + \"/\" + output_filename\ntable = pd.read_fwf(data_file, header=None)\ntable","key":"I5zcVyoWXP"},{"type":"outputs","id":"nynQgppihxFP0Giv0YqS7","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":6,"metadata":{},"data":{"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>0</th>\n      <th>1</th>\n      <th>2</th>\n      <th>3</th>\n      <th>4</th>\n      <th>5</th>\n      <th>6</th>\n      <th>7</th>\n      <th>8</th>\n      <th>9</th>\n      <th>...</th>\n      <th>91</th>\n      <th>92</th>\n      <th>93</th>\n      <th>94</th>\n      <th>95</th>\n      <th>96</th>\n      <th>97</th>\n      <th>98</th>\n      <th>99</th>\n      <th>100</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>0</td>\n      <td>0.000010</td>\n      <td>0.000025</td>\n      <td>0.000063</td>\n      <td>0.000148</td>\n      <td>0.000335</td>\n      <td>0.000732</td>\n      <td>0.001534</td>\n      <td>0.003089</td>\n      <td>0.005976</td>\n      <td>...</td>\n      <td>1.459711e-38</td>\n      <td>1.021038e-39</td>\n      <td>6.862018e-41</td>\n      <td>4.430906e-42</td>\n      <td>2.746545e-43</td>\n      <td>1.681558e-44</td>\n      <td>1.401298e-45</td>\n      <td>0.000000e+00</td>\n      <td>0.000000e+00</td>\n      <td>0.000000e+00</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>1</td>\n      <td>0.000012</td>\n      <td>0.000029</td>\n      <td>0.000071</td>\n      <td>0.000166</td>\n      <td>0.000372</td>\n      <td>0.000801</td>\n      <td>0.001661</td>\n      <td>0.003311</td>\n      <td>0.006346</td>\n      <td>...</td>\n      <td>1.171803e-37</td>\n      <td>8.800796e-39</td>\n      <td>6.354580e-40</td>\n      <td>4.410867e-41</td>\n      <td>2.942727e-42</td>\n      <td>1.891753e-43</td>\n      <td>1.261169e-44</td>\n      <td>0.000000e+00</td>\n      <td>3.892368e-07</td>\n      <td>9.964396e-07</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>2</td>\n      <td>0.000015</td>\n      <td>0.000037</td>\n      <td>0.000089</td>\n      <td>0.000204</td>\n      <td>0.000447</td>\n      <td>0.000944</td>\n      <td>0.001921</td>\n      <td>0.003764</td>\n      <td>0.007097</td>\n      <td>...</td>\n      <td>9.342945e-37</td>\n      <td>7.469310e-38</td>\n      <td>5.746058e-39</td>\n      <td>4.253277e-40</td>\n      <td>3.029047e-41</td>\n      <td>2.075323e-42</td>\n      <td>1.525808e-08</td>\n      <td>3.906043e-08</td>\n      <td>1.202751e-06</td>\n      <td>3.060115e-06</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>3</td>\n      <td>0.000021</td>\n      <td>0.000050</td>\n      <td>0.000118</td>\n      <td>0.000264</td>\n      <td>0.000566</td>\n      <td>0.001169</td>\n      <td>0.002327</td>\n      <td>0.004463</td>\n      <td>0.008249</td>\n      <td>...</td>\n      <td>6.785309e-36</td>\n      <td>5.755973e-37</td>\n      <td>4.703170e-38</td>\n      <td>3.701251e-39</td>\n      <td>5.981168e-10</td>\n      <td>1.531169e-09</td>\n      <td>7.646778e-08</td>\n      <td>1.950150e-07</td>\n      <td>2.517209e-06</td>\n      <td>6.346270e-06</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>4</td>\n      <td>0.000030</td>\n      <td>0.000070</td>\n      <td>0.000161</td>\n      <td>0.000351</td>\n      <td>0.000736</td>\n      <td>0.001487</td>\n      <td>0.002896</td>\n      <td>0.005436</td>\n      <td>0.009836</td>\n      <td>...</td>\n      <td>4.514822e-35</td>\n      <td>4.051931e-36</td>\n      <td>2.344618e-11</td>\n      <td>6.002181e-11</td>\n      <td>4.146878e-09</td>\n      <td>1.058688e-08</td>\n      <td>2.303804e-07</td>\n      <td>5.845143e-07</td>\n      <td>4.464170e-06</td>\n      <td>1.112178e-05</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>4996</th>\n      <td>96</td>\n      <td>0.178242</td>\n      <td>0.145647</td>\n      <td>0.101621</td>\n      <td>0.100381</td>\n      <td>0.122926</td>\n      <td>0.120063</td>\n      <td>0.123888</td>\n      <td>0.116525</td>\n      <td>-0.085472</td>\n      <td>...</td>\n      <td>3.023120e+00</td>\n      <td>5.041199e+00</td>\n      <td>4.517421e+00</td>\n      <td>2.471580e+00</td>\n      <td>9.274478e-01</td>\n      <td>2.414372e-01</td>\n      <td>-1.293256e-02</td>\n      <td>1.105624e-01</td>\n      <td>1.427006e-01</td>\n      <td>1.615230e-01</td>\n    </tr>\n    <tr>\n      <th>4997</th>\n      <td>97</td>\n      <td>0.166096</td>\n      <td>0.137091</td>\n      <td>-0.096517</td>\n      <td>0.101448</td>\n      <td>0.132967</td>\n      <td>0.122498</td>\n      <td>0.113014</td>\n      <td>0.109682</td>\n      <td>-0.084616</td>\n      <td>...</td>\n      <td>1.779129e+00</td>\n      <td>4.351381e+00</td>\n      <td>5.147950e+00</td>\n      <td>3.494045e+00</td>\n      <td>1.534592e+00</td>\n      <td>4.983789e-01</td>\n      <td>9.174558e-02</td>\n      <td>-7.311907e-02</td>\n      <td>1.347228e-01</td>\n      <td>1.539230e-01</td>\n    </tr>\n    <tr>\n      <th>4998</th>\n      <td>98</td>\n      <td>0.150033</td>\n      <td>0.127765</td>\n      <td>-0.095495</td>\n      <td>0.104681</td>\n      <td>0.140813</td>\n      <td>0.123673</td>\n      <td>0.101828</td>\n      <td>0.102024</td>\n      <td>-0.084990</td>\n      <td>...</td>\n      <td>7.355422e-01</td>\n      <td>3.197397e+00</td>\n      <td>5.167335e+00</td>\n      <td>4.501298e+00</td>\n      <td>2.378713e+00</td>\n      <td>9.002837e-01</td>\n      <td>2.534103e-01</td>\n      <td>-1.492602e-02</td>\n      <td>1.189377e-01</td>\n      <td>1.425529e-01</td>\n    </tr>\n    <tr>\n      <th>4999</th>\n      <td>99</td>\n      <td>0.130618</td>\n      <td>0.118058</td>\n      <td>-0.098317</td>\n      <td>0.109524</td>\n      <td>0.145394</td>\n      <td>0.123321</td>\n      <td>-0.091511</td>\n      <td>-0.094122</td>\n      <td>-0.086058</td>\n      <td>...</td>\n      <td>2.072203e-02</td>\n      <td>1.919918e+00</td>\n      <td>4.503167e+00</td>\n      <td>5.186921e+00</td>\n      <td>3.417265e+00</td>\n      <td>1.503764e+00</td>\n      <td>5.057256e-01</td>\n      <td>7.775510e-02</td>\n      <td>-8.935884e-02</td>\n      <td>1.256339e-01</td>\n    </tr>\n    <tr>\n      <th>5000</th>\n      <td>0</td>\n      <td>0.108276</td>\n      <td>0.108241</td>\n      <td>0.104191</td>\n      <td>0.115224</td>\n      <td>0.146075</td>\n      <td>0.121337</td>\n      <td>-0.083074</td>\n      <td>-0.086573</td>\n      <td>-0.087238</td>\n      <td>...</td>\n      <td>3.938838e-01</td>\n      <td>8.310862e-01</td>\n      <td>3.336946e+00</td>\n      <td>5.263032e+00</td>\n      <td>4.469062e+00</td>\n      <td>2.348540e+00</td>\n      <td>8.970855e-01</td>\n      <td>2.271172e-01</td>\n      <td>-3.692843e-02</td>\n      <td>1.003862e-01</td>\n    </tr>\n  </tbody>\n</table>\n<p>5001 rows × 101 columns</p>\n</div>","content_type":"text/html"},"text/plain":{"content":"      0         1         2         3         4         5         6    \\\n0       0  0.000010  0.000025  0.000063  0.000148  0.000335  0.000732   \n1       1  0.000012  0.000029  0.000071  0.000166  0.000372  0.000801   \n2       2  0.000015  0.000037  0.000089  0.000204  0.000447  0.000944   \n3       3  0.000021  0.000050  0.000118  0.000264  0.000566  0.001169   \n4       4  0.000030  0.000070  0.000161  0.000351  0.000736  0.001487   \n...   ...       ...       ...       ...       ...       ...       ...   \n4996   96  0.178242  0.145647  0.101621  0.100381  0.122926  0.120063   \n4997   97  0.166096  0.137091 -0.096517  0.101448  0.132967  0.122498   \n4998   98  0.150033  0.127765 -0.095495  0.104681  0.140813  0.123673   \n4999   99  0.130618  0.118058 -0.098317  0.109524  0.145394  0.123321   \n5000    0  0.108276  0.108241  0.104191  0.115224  0.146075  0.121337   \n\n           7         8         9    ...           91            92   \\\n0     0.001534  0.003089  0.005976  ...  1.459711e-38  1.021038e-39   \n1     0.001661  0.003311  0.006346  ...  1.171803e-37  8.800796e-39   \n2     0.001921  0.003764  0.007097  ...  9.342945e-37  7.469310e-38   \n3     0.002327  0.004463  0.008249  ...  6.785309e-36  5.755973e-37   \n4     0.002896  0.005436  0.009836  ...  4.514822e-35  4.051931e-36   \n...        ...       ...       ...  ...           ...           ...   \n4996  0.123888  0.116525 -0.085472  ...  3.023120e+00  5.041199e+00   \n4997  0.113014  0.109682 -0.084616  ...  1.779129e+00  4.351381e+00   \n4998  0.101828  0.102024 -0.084990  ...  7.355422e-01  3.197397e+00   \n4999 -0.091511 -0.094122 -0.086058  ...  2.072203e-02  1.919918e+00   \n5000 -0.083074 -0.086573 -0.087238  ...  3.938838e-01  8.310862e-01   \n\n               93            94            95            96            97   \\\n0     6.862018e-41  4.430906e-42  2.746545e-43  1.681558e-44  1.401298e-45   \n1     6.354580e-40  4.410867e-41  2.942727e-42  1.891753e-43  1.261169e-44   \n2     5.746058e-39  4.253277e-40  3.029047e-41  2.075323e-42  1.525808e-08   \n3     4.703170e-38  3.701251e-39  5.981168e-10  1.531169e-09  7.646778e-08   \n4     2.344618e-11  6.002181e-11  4.146878e-09  1.058688e-08  2.303804e-07   \n...            ...           ...           ...           ...           ...   \n4996  4.517421e+00  2.471580e+00  9.274478e-01  2.414372e-01 -1.293256e-02   \n4997  5.147950e+00  3.494045e+00  1.534592e+00  4.983789e-01  9.174558e-02   \n4998  5.167335e+00  4.501298e+00  2.378713e+00  9.002837e-01  2.534103e-01   \n4999  4.503167e+00  5.186921e+00  3.417265e+00  1.503764e+00  5.057256e-01   \n5000  3.336946e+00  5.263032e+00  4.469062e+00  2.348540e+00  8.970855e-01   \n\n               98            99            100  \n0     0.000000e+00  0.000000e+00  0.000000e+00  \n1     0.000000e+00  3.892368e-07  9.964396e-07  \n2     3.906043e-08  1.202751e-06  3.060115e-06  \n3     1.950150e-07  2.517209e-06  6.346270e-06  \n4     5.845143e-07  4.464170e-06  1.112178e-05  \n...            ...           ...           ...  \n4996  1.105624e-01  1.427006e-01  1.615230e-01  \n4997 -7.311907e-02  1.347228e-01  1.539230e-01  \n4998 -1.492602e-02  1.189377e-01  1.425529e-01  \n4999  7.775510e-02 -8.935884e-02  1.256339e-01  \n5000  2.271172e-01 -3.692843e-02  1.003862e-01  \n\n[5001 rows x 101 columns]","content_type":"text/plain"}}},"children":[],"key":"nFf2THZLMH"}],"key":"nIEsc3XJBd"}],"key":"P7WModEYmb"}],"key":"Wl00QwI2AN"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Tsunami Simulator Plotter","url":"/sections/computer-programming/fortran/modern-fortran/tsunami-simulator-plotter","group":"Computer Programming"},"next":{"title":"Tsunami Simulator with Modules Plotter","url":"/sections/computer-programming/fortran/modern-fortran/tsunami-simulator-with-modules-plotter","group":"Computer Programming"}}},"domain":"http://localhost:3009"}